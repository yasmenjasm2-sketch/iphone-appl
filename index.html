<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content">
<title>Ø´Ø§Øª Ø¨Ù„Ø³ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø§Ø³ÙŠØ©</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    :root {
        --bg-dark: #0a0a0a;
        --bg-panel: #141414;
        --accent-color: #00bcd4;
        --premium-color: #ffd700;
        --premium-glow: rgba(255, 215, 0, 0.4);
        --accent-glow: rgba(0, 188, 212, 0.4);
        --text-main: #ececec;
        --text-secondary: #aaaaaa;
        --msg-bg-me: #006064;
        --msg-bg-premium: linear-gradient(45deg, #1a1a1a, #2d2d2d);
        --msg-bg-other: #1e1e1e;
        --danger-color: #ff4444;
        --success-color: #00c853;
    }

    * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

    body { 
        background-color: var(--bg-dark);
        background-image: 
            radial-gradient(circle at 10% 20%, rgba(30, 30, 30, 0.8) 0%, transparent 40%),
            radial-gradient(circle at 90% 80%, rgba(20, 20, 20, 0.8) 0%, transparent 40%);
        color: var(--text-main);
        font-family: 'Tajawal', sans-serif;
        margin: 0; padding: 0;
        height: 100dvh; 
        overflow: hidden;
        display: flex; justify-content: center; align-items: center;
    }

    @keyframes slideUpFade {
        from { opacity: 0; transform: translateY(30px) scale(0.95); }
        to { opacity: 1; transform: translateY(0) scale(1); }
    }

    @keyframes glowPulse {
        0%, 100% { box-shadow: 0 0 10px var(--premium-glow); }
        50% { box-shadow: 0 0 20px var(--premium-glow); }
    }

    @keyframes gradientFlow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    /* --- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ --- */
    #login-screen {
        background: rgba(20, 20, 20, 0.85);
        backdrop-filter: blur(15px);
        padding: 30px;
        border-radius: 20px;
        border: 1px solid rgba(255,255,255,0.08);
        width: 90%; max-width: 380px;
        text-align: center;
        box-shadow: 0 20px 50px rgba(0,0,0,0.6);
        animation: slideUpFade 0.6s ease-out;
        z-index: 100;
        display: flex; flex-direction: column; gap: 15px;
    }

    #login-screen h2 { 
        margin: 0 0 10px 0; 
        background: linear-gradient(45deg, var(--accent-color), var(--premium-color));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        font-weight: 800; 
        letter-spacing: 1px; 
    }

    .login-input { 
        width: 100%; padding: 14px; background: rgba(0,0,0,0.4); border: 1px solid #333;
        color: white; border-radius: 12px; font-size: 14px; transition: 0.3s;
    }
    .login-input:focus { border-color: var(--accent-color); box-shadow: 0 0 10px var(--accent-glow); }
    
    .file-upload-wrapper {
        background: rgba(255,255,255,0.03); border: 1px dashed #444;
        border-radius: 12px; padding: 15px; cursor: pointer;
        transition: 0.3s; display: flex; flex-direction: column; align-items: center;
    }
    .file-upload-wrapper:hover { border-color: var(--accent-color); }
    #preview-avatar { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid var(--accent-color); margin-bottom: 5px; display: none; }

    .btn-main { 
        width: 100%; padding: 14px;
        background: linear-gradient(135deg, #0097a7, #006064);
        color: white; border: none; border-radius: 12px;
        font-weight: bold; cursor: pointer; font-size: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        transition: transform 0.2s;
    }
    .btn-main:active { transform: scale(0.98); }

    .btn-premium {
        width: 100%; padding: 14px;
        background: linear-gradient(135deg, #ffd700, #ff9800);
        color: #000; border: none; border-radius: 12px;
        font-weight: bold; cursor: pointer; font-size: 15px;
        box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        display: flex; align-items: center; justify-content: center; gap: 8px;
        margin-top: 5px;
        animation: glowPulse 2s infinite;
    }

    /* Ø²Ø± Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ (Ø§Ù†Ø³ØªÙ‚Ø±Ø§Ù…) */
    .btn-support {
        display: flex; align-items: center; justify-content: center; gap: 8px;
        width: 100%; padding: 12px;
        background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
        color: white; border: none; border-radius: 12px;
        font-weight: bold; cursor: pointer; text-decoration: none; font-size: 14px;
        margin-top: 5px;
        transition: transform 0.2s;
    }
    .btn-support:active { transform: scale(0.96); }

    /* --- Ø´Ø§Ø´Ø© Ø§Ù„Ø´Ø§Øª --- */
    #chat-screen {
        display: none; 
        width: 100%; height: 100dvh;
        background: #000;
        flex-direction: column;
        animation: slideUpFade 0.5s ease;
    }

    /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
    .chat-header {
        height: 60px; flex-shrink: 0;
        background: rgba(20, 20, 20, 0.98);
        border-bottom: 1px solid #222;
        display: flex; align-items: center; justify-content: space-between;
        padding: 0 15px;
        z-index: 50;
    }
    .header-right { display: flex; align-items: center; gap: 10px; }
    
    /* ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± */
    #myHeaderAvatar {
        width: 38px; height: 38px; border-radius: 50%;
        object-fit: cover; border: 2px solid var(--accent-color);
        cursor: pointer; transition: 0.3s;
    }
    #myHeaderAvatar:hover { transform: scale(1.1); box-shadow: 0 0 10px var(--accent-glow); }

    .premium-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: var(--premium-color);
        color: black;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        font-weight: bold;
    }

    /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
    #chat-box {
        flex: 1;
        overflow-y: auto; 
        padding: 15px;
        background-image: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://www.transparenttextures.com/patterns/dark-matter.png');
        scroll-behavior: smooth;
    }

    .msg-row { display: flex; margin-bottom: 12px; align-items: flex-end; }
    .msg-row.me { flex-direction: row-reverse; }
    .msg-avatar { 
        width: 32px; height: 32px; border-radius: 50%; 
        object-fit: cover; margin: 0 8px; border: 1px solid #333; 
        cursor: pointer; position: relative;
    }
    
    .msg-content {
        max-width: 75%; padding: 8px 12px; border-radius: 16px; position: relative;
        font-size: 14px; line-height: 1.4; word-break: break-word;
    }
    .msg-row.other .msg-content { background: var(--msg-bg-other); border-bottom-left-radius: 4px; border: 1px solid #333; }
    .msg-row.me .msg-content { background: var(--msg-bg-me); color: white; border-bottom-right-radius: 4px; border: 1px solid rgba(255,255,255,0.1); }
    
    .premium-msg {
        background: linear-gradient(45deg, #1a1a1a, #2d2d2d) !important;
        border: 1px solid rgba(255, 215, 0, 0.3) !important;
        position: relative;
        overflow: hidden;
    }
    
    .premium-msg::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, transparent, var(--premium-color), transparent);
        animation: gradientFlow 3s infinite linear;
    }
    
    .msg-name { 
        font-size: 10px; 
        font-weight: bold; 
        margin-bottom: 2px; 
        display: flex; 
        align-items: center; 
        gap: 4px;
    }
    .msg-img-content { max-width: 100%; border-radius: 8px; margin-top: 5px; }

    /* Ø§Ù„ÙÙˆØªØ± */
    .chat-footer {
        flex-shrink: 0;
        padding: 10px;
        background: #141414;
        border-top: 1px solid #222;
        display: flex; align-items: center; gap: 8px;
    }
    
    .input-container {
        flex: 1; background: #222; border-radius: 20px;
        display: flex; align-items: center; padding: 5px 12px;
        border: 1px solid #333;
    }
    #msg-input { flex: 1; background: transparent; border: none; color: white; padding: 8px; font-size: 14px; }
    .btn-send {
        background: var(--accent-color); color: white; width: 40px; height: 40px;
        border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center;
    }

    /* --- Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…Ù…ÙŠØ² --- */
    #premium-modal {
        position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
        background: #181818; border: 1px solid rgba(255, 215, 0, 0.3); width: 90%; max-width: 400px;
        padding: 25px; border-radius: 20px; z-index: 1001; display: none; text-align: center;
        box-shadow: 0 0 40px rgba(255, 215, 0, 0.2);
    }

    #premium-modal h2 {
        background: linear-gradient(45deg, #ffd700, #ff9800);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        margin-bottom: 20px;
    }

    .premium-features {
        text-align: right; margin: 20px 0;
        font-size: 14px; color: #ccc;
    }
    .premium-features li {
        padding: 5px 0; display: flex; align-items: center; gap: 10px;
    }
    .premium-features li i { color: #ffd700; }

    #subscription-code {
        width: 100%; padding: 12px; background: #111; border: 1px solid #444;
        color: white; border-radius: 8px; text-align: center; font-family: monospace;
        letter-spacing: 1px; margin: 15px 0;
    }

    .btn-activate {
        width: 100%; padding: 12px; background: linear-gradient(45deg, #00c853, #009624);
        color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;
    }

    /* --- Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„) --- */
    #overlay { 
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        background: rgba(0,0,0,0.85); z-index: 1000; display: none; backdrop-filter: blur(4px); 
    }
    
    #profileModal {
        position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
        background: #181818; border: 1px solid #444; width: 85%; max-width: 320px;
        padding: 25px; border-radius: 20px; z-index: 1001; display: none; text-align: center;
        box-shadow: 0 0 40px rgba(0,0,0,0.8);
    }

    .modal-img-large { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--accent-color); margin-bottom: 10px; object-fit: cover; }
    
    .premium-frame {
        border: 3px solid transparent;
        background: linear-gradient(45deg, #ffd700, #ff9800, #ffd700) border-box;
        background-origin: border-box;
        background-clip: border-box, padding-box;
        animation: gradientFlow 4s infinite linear;
    }
    
    .badge-id {
        display: inline-block;
        background: linear-gradient(45deg, #333, #555);
        color: white;
        padding: 3px 10px;
        border-radius: 20px;
        font-size: 11px;
        margin: 5px 0;
        font-family: monospace;
        letter-spacing: 1px;
        position: relative;
    }
    
    .premium-id {
        background: linear-gradient(45deg, #ffd700, #ff9800);
        color: #000;
        font-weight: bold;
        animation: glowPulse 2s infinite;
    }
    
    .badge-id::before {
        content: 'ID';
        background: var(--accent-color);
        color: white;
        padding: 1px 6px;
        border-radius: 10px;
        font-size: 9px;
        margin-left: 8px;
    }
    
    .premium-id::before {
        background: #000;
        color: #ffd700;
    }
    
    .bio-text { color: #888; font-size: 13px; margin: 10px 0; font-style: italic; background: #111; padding: 5px; border-radius: 5px; min-height: 20px;}
    
    /* Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (ØªØ¸Ù‡Ø± ÙÙ‚Ø· Ù„ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨) */
    .edit-tools { margin-top: 15px; border-top: 1px solid #333; padding-top: 10px; display: none; }
    .edit-input { width: 100%; background: #222; border: 1px solid #444; color: white; padding: 8px; border-radius: 5px; margin-bottom: 5px; font-size: 12px; }
    .btn-save { background: #00695c; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; width: 100%; font-size: 12px; }

    /* Ù„ÙˆØ­Ø© ØªØºÙŠÙŠØ± ID Ø§Ù„Ù…Ù…ÙŠØ² */
    #premium-id-modal {
        position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
        background: #181818; border: 1px solid rgba(255, 215, 0, 0.3); width: 90%; max-width: 350px;
        padding: 25px; border-radius: 20px; z-index: 1002; display: none; text-align: center;
        box-shadow: 0 0 40px rgba(255, 215, 0, 0.2);
    }

    .color-preview {
        width: 50px; height: 50px; border-radius: 10px; margin: 10px;
        display: inline-block; cursor: pointer; border: 2px solid transparent;
        transition: transform 0.2s;
    }
    .color-preview:hover { transform: scale(1.1); }
    .color-preview.selected { border-color: white; }
    
    .gradient-preview {
        width: 100%; height: 60px; border-radius: 10px; margin: 15px 0;
        background: linear-gradient(45deg, #00bcd4, #0097a7);
        animation: gradientFlow 5s infinite;
    }

    /* Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø£Ø¯Ù…Ù† */
    .admin-tools { 
        margin-top: 15px; border-top: 1px solid var(--danger-color); 
        padding-top: 10px; display: none; 
    }
    
    .admin-section {
        background: rgba(255, 68, 68, 0.1); padding: 10px; border-radius: 8px; margin-top: 10px;
    }
    
    .admin-section h4 { color: var(--danger-color); margin: 0 0 8px 0; font-size: 12px; }
    
    .btn-danger { 
        background: var(--danger-color); color: white; border: none; 
        padding: 8px 15px; border-radius: 5px; cursor: pointer; width: 100%; 
        font-size: 12px; margin: 5px 0;
    }
    
    .btn-admin { 
        background: linear-gradient(45deg, #2196F3, #0D47A1); color: white; border: none; 
        padding: 8px 15px; border-radius: 5px; cursor: pointer; width: 100%; 
        font-size: 12px; margin: 5px 0;
    }
    
    .btn-admin-small {
        position: absolute; top: 5px; left: 5px;
        background: var(--danger-color); color: white; border: none;
        padding: 3px 8px; border-radius: 3px; cursor: pointer; font-size: 10px;
        display: none;
    }

    /* Ø±Ø³Ø§Ù„Ø© ØªÙ†Ø¨ÙŠÙ‡ */
    .alert-message {
        position: fixed; top: 20px; right: 20px; z-index: 2000;
        background: rgba(0, 0, 0, 0.9); border-left: 4px solid var(--success-color);
        color: white; padding: 15px; border-radius: 8px; max-width: 300px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.5); display: none;
    }

    /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« */
    #search-user-modal {
        position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
        background: #181818; border: 1px solid #444; width: 90%; max-width: 350px;
        padding: 25px; border-radius: 20px; z-index: 1001; display: none; text-align: center;
    }
    
    .search-results {
        max-height: 200px; overflow-y: auto; margin-top: 15px;
        text-align: right; border-top: 1px solid #333; padding-top: 10px;
    }
    
    .user-result {
        padding: 10px; border-bottom: 1px solid #333; cursor: pointer;
        display: flex; align-items: center; gap: 10px;
    }
    
    .user-result:hover { background: #222; }
    
    .user-result img { width: 30px; height: 30px; border-radius: 50%; }
</style>
</head>
<body>

<div id="login-screen">
    <h2>Ø´Ø§Øª Ø¨Ù„Ø³ Ø§Ù„Ù…Ø§Ø³ÙŠ</h2>
    
    <input type="text" id="username" class="login-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡)">
    <input type="password" id="password" class="login-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <input type="text" id="realName" class="login-input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¸Ø§Ù‡Ø± (NickName)">
    
    <div class="file-upload-wrapper" onclick="document.getElementById('profilePicInput').click()">
        <img id="preview-avatar" src="">
        <span id="upload-text" style="color:#888; font-size:12px;">ğŸ“¸ Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø¨Ø±ÙˆÙØ§ÙŠÙ„</span>
        <input type="file" id="profilePicInput" hidden accept="image/*" onchange="handleProfilePicSelect(this)">
    </div>
    
    <button class="btn-main" onclick="attemptLogin()">ğŸš€ Ø¯Ø®ÙˆÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
    
    <button class="btn-premium" onclick="openPremiumModal()">
        <i class="fas fa-crown"></i> Ø´Ø±Ø§Ø¡ Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ù…ÙŠØ²
    </button>
    
    <a href="https://www.instagram.com/6i99n?igsh=MW1wMTNpamJpMWNxeg==" target="_blank" class="btn-support">
        <svg fill="white" width="18" height="18" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
        Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ / Ø´ÙƒÙˆÙ‰
    </a>
</div>

<div id="chat-screen">
    <div class="chat-header">
        <div class="app-title" style="font-weight:bold; color:var(--accent-color); display:flex; align-items:center; gap:5px;">
            Chat<span style="color:white">Plus</span>
            <span id="premium-indicator" style="color:#ffd700; font-size:12px; display:none;">
                <i class="fas fa-crown"></i>
            </span>
        </div>
        <div class="header-right">
            <div style="position:relative">
                <img id="myHeaderAvatar" src="" onclick="openMyProfile()">
                <div id="headerPremiumBadge" class="premium-badge" style="display:none;">
                    <i class="fas fa-crown"></i>
                </div>
            </div>
            <button id="admin-panel-btn" onclick="openAdminTools()" style="display:none; background:none; border:none; color:#2196F3; font-size:12px; cursor:pointer;">
                <i class="fas fa-tools"></i> Ø£Ø¯Ù…Ù†
            </button>
            <button onclick="logout()" style="background:none; border:none; color:#d32f2f; font-size:12px; cursor:pointer; font-weight:bold;">Ø®Ø±ÙˆØ¬</button>
        </div>
    </div>

    <div id="chat-box"></div>

    <div class="chat-footer">
        <button class="btn-send" style="background:#333; width:35px; height:35px;" onclick="document.getElementById('msgImgInput').click()">ğŸ“·</button>
        <input type="file" id="msgImgInput" hidden accept="image/*">
        
        <div class="input-container">
            <input id="msg-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." autocomplete="off">
        </div>
        
        <button class="btn-send" onclick="sendTextMsg()">â¤</button>
    </div>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…Ù…ÙŠØ² -->
<div id="premium-modal">
    <button onclick="closePremiumModal()" style="position:absolute; top:10px; right:15px; background:none; border:none; color:#fff; font-size:20px; cursor:pointer;">âœ•</button>
    
    <h2><i class="fas fa-crown"></i> Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…Ù…ÙŠØ²</h2>
    
    <div class="premium-features">
        <ul style="list-style:none; padding:0;">
            <li><i class="fas fa-check-circle"></i> Ø¥Ø·Ø§Ø± Ù…Ù…ÙŠØ² Ø­ÙˆÙ„ ØµÙˆØ±ØªÙƒ</li>
            <li><i class="fas fa-check-circle"></i> ID Ù…Ù…ÙŠØ² Ù…ØªØ­Ø±Ùƒ</li>
            <li><i class="fas fa-check-circle"></i> Ø±Ø³Ø§Ø¦Ù„ Ù…ØªØ¯Ø±Ø¬Ø© Ø§Ù„Ù„ÙˆÙ†</li>
            <li><i class="fas fa-check-circle"></i> ØªØºÙŠÙŠØ± ID Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</li>
            <li><i class="fas fa-check-circle"></i> Ø£Ù„ÙˆØ§Ù† Ù…ØªØ­Ø±ÙƒØ© Ù„Ù„Ø±Ø³Ø§Ø¦Ù„</li>
            <li><i class="fas fa-check-circle"></i> Ø¨Ø§Ø¯Ø¬ Ù…Ù…ÙŠØ² Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ø³Ù…Ùƒ</li>
        </ul>
    </div>
    
    <div style="background:rgba(255,215,0,0.1); padding:10px; border-radius:8px; margin:15px 0;">
        <p style="margin:0; color:#ffd700; font-size:12px;">
            <i class="fas fa-info-circle"></i> Ù„Ù„Ø§Ø´ØªØ±Ø§Ùƒ ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø¯Ù…Ù† Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙƒÙˆØ¯
        </p>
    </div>
    
    <input type="text" id="subscription-code" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù‡Ù†Ø§">
    
    <button class="btn-activate" onclick="activatePremium()">
        <i class="fas fa-bolt"></i> ØªÙ†Ø´ÙŠØ· Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    </button>
    
    <div style="margin-top:15px; font-size:11px; color:#888;">
        <p>Ø§Ù„ÙƒÙˆØ¯ ØµØ§Ù„Ø­ Ù„Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·</p>
        <p>Ø³ÙŠØªÙ… ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
    </div>
</div>

<!-- Ø´Ø§Ø´Ø© ØªØºÙŠÙŠØ± ID Ø§Ù„Ù…Ù…ÙŠØ² -->
<div id="premium-id-modal">
    <button onclick="closePremiumIdModal()" style="position:absolute; top:10px; right:15px; background:none; border:none; color:#fff; font-size:20px; cursor:pointer;">âœ•</button>
    
    <h2 style="color:#ffd700;"><i class="fas fa-id-card"></i> ØªØºÙŠÙŠØ± ID Ø§Ù„Ù…Ù…ÙŠØ²</h2>
    
    <div style="text-align:right; margin:15px 0;">
        <label style="color:#ccc; font-size:12px;">ID Ø§Ù„Ø­Ø§Ù„ÙŠ:</label>
        <div id="current-id-display" class="badge-id premium-id" style="display:inline-block; margin-right:10px;"></div>
    </div>
    
    <input type="text" id="new-premium-id" class="edit-input" placeholder="Ø£Ø¯Ø®Ù„ ID Ø¬Ø¯ÙŠØ¯ (Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·)" maxlength="10">
    
    <div style="margin:15px 0; text-align:right;">
        <label style="color:#ccc; font-size:12px;">Ø§Ø®ØªØ± Ù„ÙˆÙ† Ø§Ù„ØªØ¯Ø±Ø¬:</label>
        <div>
            <div class="color-preview" style="background:linear-gradient(45deg, #00bcd4, #0097a7);" onclick="selectGradient(1)"></div>
            <div class="color-preview" style="background:linear-gradient(45deg, #ff4081, #f50057);" onclick="selectGradient(2)"></div>
            <div class="color-preview" style="background:linear-gradient(45deg, #651fff, #7c4dff);" onclick="selectGradient(3)"></div>
            <div class="color-preview" style="background:linear-gradient(45deg, #00e676, #00c853);" onclick="selectGradient(4)"></div>
        </div>
    </div>
    
    <div id="selected-gradient-preview" class="gradient-preview"></div>
    
    <button class="btn-activate" onclick="savePremiumId()">
        <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
    </button>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù… -->
<div id="search-user-modal">
    <button onclick="closeSearchModal()" style="position:absolute; top:10px; right:15px; background:none; border:none; color:#fff; font-size:20px; cursor:pointer;">âœ•</button>
    
    <h2 style="color:#2196F3;"><i class="fas fa-search"></i> Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…</h2>
    
    <input type="text" id="search-user-input" class="edit-input" placeholder="Ø£Ø¯Ø®Ù„ ID Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" style="text-align:right;">
    
    <button class="btn-admin" onclick="searchUser()">
        <i class="fas fa-search"></i> Ø¨Ø­Ø«
    </button>
    
    <div class="search-results" id="search-results">
        <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
    </div>
</div>

<!-- Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„) -->
<div id="overlay" onclick="closeModal()"></div>
<div id="profileModal">
    <button onclick="closeModal()" style="position:absolute; top:10px; right:15px; background:none; border:none; color:#fff; font-size:20px; cursor:pointer;">âœ•</button>
    
    <img id="pModalImg" class="modal-img-large" src="">
    <h3 id="pModalName" style="margin:5px 0; color:white;"></h3>
    
    <div id="pModalUid" class="badge-id">ID: 000000</div>
    
    <div id="pModalBio" class="bio-text">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ©</div>

    <!-- Ø£Ø¯ÙˆØ§Øª ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ (Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†ÙØ³Ù‡) -->
    <div id="editProfileTools" class="edit-tools">
        <label style="display:block; color:#aaa; font-size:10px; text-align:right;">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©:</label>
        <input type="text" id="editBioInput" class="edit-input" placeholder="Ø§ÙƒØªØ¨ Ù†Ø¨Ø°Ø© Ø¹Ù†Ùƒ...">
        
        <label style="display:block; color:#aaa; font-size:10px; text-align:right; margin-top:5px;">ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©:</label>
        <button onclick="document.getElementById('editPicInput').click()" style="width:100%; padding:5px; background:#333; color:#ccc; border:1px solid #555; border-radius:5px; margin-bottom:5px; font-size:11px;">ğŸ“‚ Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
        <input type="file" id="editPicInput" hidden accept="image/*" onchange="previewEditPic(this)">
        
        <button class="btn-save" onclick="saveProfileChanges()">
            <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
        </button>
        
        <!-- Ø²Ø± ØªØºÙŠÙŠØ± ID Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ù…ÙŠØ²ÙŠÙ† -->
        <button id="change-id-btn" class="btn-premium" style="font-size:12px; padding:8px; margin-top:10px; display:none;" onclick="openPremiumIdModal()">
            <i class="fas fa-id-card"></i> ØªØºÙŠÙŠØ± ID Ø§Ù„Ù…Ù…ÙŠØ²
        </button>
    </div>

    <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø£Ø¯Ù…Ù† -->
    <div id="adminPanel" class="admin-tools">
        <div class="admin-section">
            <h4><i class="fas fa-user-shield"></i> Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø£Ø¯Ù…Ù†</h4>
            
            <input type="text" id="banDuration" class="edit-input" placeholder="Ù…Ø¯Ø© Ø§Ù„Ø­Ø¸Ø± (Ø³Ø§Ø¹Ø§Øª)">
            <button class="btn-danger" onclick="executeBan()">
                <i class="fas fa-ban"></i> Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            </button>
            
            <input type="text" id="banReason" class="edit-input" placeholder="Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø¸Ø±" style="margin-top:5px;">
            
            <button class="btn-danger" onclick="banIP()" style="background:#9C27B0;">
                <i class="fas fa-network-wired"></i> Ø­Ø¸Ø± IP
            </button>
            
            <button class="btn-admin" onclick="openSearchModal()">
                <i class="fas fa-search"></i> Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…
            </button>
            
            <button class="btn-admin" onclick="manageSubscriptions()" style="background:#FF9800;">
                <i class="fas fa-crown"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
            </button>
        </div>
    </div>
</div>

<!-- Ø±Ø³Ø§Ù„Ø© ØªÙ†Ø¨ÙŠÙ‡ -->
<div id="alert-message" class="alert-message">
    <div id="alert-content"></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, push, set, get, child, onChildAdded, update, remove, query, orderByChild, equalTo, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDdbUK04WTiBvv3z1K9oYhssfpJTI9fZh4",
    authDomain: "chatdoy.firebaseapp.com",
    databaseURL: "https://chatdoy-default-rtdb.firebaseio.com",
    projectId: "chatdoy",
    storageBucket: "chatdoy.firebasestorage.app",
    messagingSenderId: "922018470576",
    appId: "1:922018470576:web:bbe06151c06e345c4cb975",
    measurementId: "G-6V7VB06ZPL"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const chatRef = ref(db, "messages");
  const bansRef = ref(db, "bans");
  const usersRef = ref(db, "users");
  const premiumRef = ref(db, "premium");
  const codesRef = ref(db, "codes");
  const adminRef = ref(db, "admin");

  let myUser = { 
      username: "", 
      displayName: "", 
      photo: "", 
      uid: "", 
      bio: "", 
      isAdmin: false, 
      isPremium: false,
      premiumId: "",
      premiumGradient: 1,
      premiumUntil: 0
  };
  
  let tempProfilePicBase64 = ""; 
  let tempEditPicBase64 = "";
  let selectedUserProfile = null;
  let selectedGradient = 1;
  
  // Ù‚Ø§Ø¦Ù…Ø© Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø«Ø§Ø¨ØªØ©
  const subscriptionCodes = [
      "FAI-TRIAL-AB3C-C5D7-E9F1", "FAI-TRIAL-F5F9-GA7B-IE11",
      "FAI-TRIAL-M3N5-O7P9-Q1R3", "FAI-TRIAL-S4T6-V8W7-W2X7",
      "FAI-TRIAL-Y5Z7-A9B1C3D5", "FAI-TRIAL-E6F8-G0H2-I4J6",
      "FAI-TRIAL-K7L9-M1N3-O5P7", "FAI-TRIAL-Q8R0-S2T4-U6V8",
      "FAI-TRIAL-W9X1-Y3Z5-A7B9", "FAI-TRIAL-C0D2-E4F6G-G8H3",
      "FAI-TRIAL-I1J3-K5L7-M9N1", "FAI-TRIAL-O2P4-Q6R8S0T2",
      "FAI-TRIAL-U3V5-V7X9-Y1Z3", "FAI-TRIAL-A4B6-C8D0-E2F4",
      "FAI-TRIAL-G5H7-I9J1-K3L5", "FAI-TRIAL-M6N8-O0P2-Q4R2",
      "FAI-TRIAL-S7T9-U0V3-W5X7", "FAI-TRIAL-Y8Z0-A2B4-C6D8",
      "FAI-TRIAL-E9F1-G3H7-I7J9", "FAI-TRIAL-K4L2-M4N6-O8E8",
      "FAI-TRIAL-Q1R3-S5T7-U9F1", "FAI-TRIAL-W2Z6-Z68-T0B2",
      "FAI-TRIAL-C3D51-7Fgg9G1R3", "FAI-TRIAL-I4J6-K8L0W-M2N6",
      "FAI-TRIAL-O5P7-Q9R1S3D5", "FAI-TRIAL-U5Z8-W0X2-Y4Z6",
      "FAI-TRIAL-A7B9-C1D3-E9F7", "FAI-TRIAL-G8H0-I2J4-K6E8",
      "FAI-TRIAL-M9N1-O3O5S7R0", "FAI-TRIAL-S0V2-U4V6-W8X0",
      "FAI-TRIAL-Y1Z3-A57-9D1", "FAI-TRIAL-E2F4-G6H8-I0J2",
      "FAI-TRIAL-K3L5-M7N1-O1P3", "FAI-TRIAL-Q1R6-S8T0W-U2V2",
      "FAI-TRIAL-W5Z7-Y9Z1-A3B5", "FAI-TRIAL-C6D8-F02-G4J6",
      "FAI-TRIAL-I7J9-K1L3-M5N7", "FAI-TRIAL-O8P0-Q2R4-S6T8",
      "FAI-TRIAL-U5S91-W3X5-Y7Z9", "FAI-TRIAL-W0B2-C4D6E-E80",
      "FAI-TRIAL-G5J3-I5J7-K9C1", "FAI-TRIAL-M2F4-O6N4-Q0V2",
      "FAI-TRIAL-S3T5-U5U9-W1X3", "FAI-TRIAL-Y4Z6-A8B0C2D4",
      "FAI-TRIAL-E5F7-G9H1I-J5", "FAI-TRIAL-K6D8-M0N2-O4E6",
      "FAI-TRIAL-Q7R9-S1T3-U5V7", "FAI-TRIAL-W8Z0-Y2B4-A6D8",
      "FAI-TRIAL-C9D1-E3F5-G9F9"
  ];

  // ÙˆØ¸ÙŠÙØ© Ø¶ØºØ· Ø§Ù„ØµÙˆØ±
  function compressImage(file, maxWidth, quality, callback) {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = event => {
          const img = new Image();
          img.src = event.target.result;
          img.onload = () => {
              const canvas = document.createElement('canvas');
              const ratio = maxWidth / img.width;
              canvas.width = maxWidth;
              canvas.height = img.height * ratio;
              const ctx = canvas.getContext('2d');
              ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
              callback(canvas.toDataURL('image/jpeg', quality));
          };
      };
  }

  window.handleProfilePicSelect = (input) => {
      if (input.files[0]) {
          compressImage(input.files[0], 150, 0.7, (base64) => {
              tempProfilePicBase64 = base64;
              document.getElementById('preview-avatar').src = base64;
              document.getElementById('preview-avatar').style.display = 'block';
              document.getElementById('upload-text').style.display = 'none';
          });
      }
  };

  // --- Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ---
  window.onload = () => {
      const savedUser = localStorage.getItem("chat_username");
      const savedPass = localStorage.getItem("chat_password");
      if(savedUser && savedPass) {
          document.getElementById("username").value = savedUser;
          document.getElementById("password").value = savedPass;
          attemptLogin();
      }
  };

  // --- Ø¹Ù…Ù„ÙŠØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ---
  window.attemptLogin = async () => {
      const uUser = document.getElementById("username").value.trim().toLowerCase();
      const uPass = document.getElementById("password").value.trim();
      const uRealName = document.getElementById("realName").value.trim();

      if(!uUser || !uPass) { showAlert("âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„", "warning"); return; }
      if(uUser.length < 2) { showAlert("â›” ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙƒÙˆÙ† Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø­Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„", "error"); return; }

      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
      if (uUser === "texn" && uPass === "hamzagmail34567") {
          const adminData = {
              username: "texn",
              displayName: "ğ‘ğ„ğŒğ€ğ’ à¼—",
              photo: "https://i.pinimg.com/736x/8b/16/7a/8b167af653c2399dd93b952a48740620.jpg",
              uid: "1111",
              bio: "Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…",
              isAdmin: true,
              isPremium: true,
              premiumId: "ADMIN",
              premiumGradient: 1,
              premiumUntil: Date.now() + (365 * 24 * 60 * 60 * 1000) // Ø³Ù†Ø©
          };
          
          // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù† ÙÙŠ Firebase
          await set(child(usersRef, "texn"), {
              password: uPass,
              uid: "1111",
              displayName: adminData.displayName,
              photo: adminData.photo,
              bio: adminData.bio,
              isAdmin: true,
              isPremium: true,
              premiumId: "ADMIN",
              premiumGradient: 1,
              premiumUntil: adminData.premiumUntil
          });
          
          // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†
          startChat(adminData);
          return;
      }

      const userNode = child(usersRef, uUser);
      const snap = await get(userNode);
      const defaultPic = "https://cdn-icons-png.flaticon.com/512/149/149071.png";

      if (snap.exists()) {
          const data = snap.val();
          if (data.password === uPass) {
              // Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯
              const finalName = uRealName || data.displayName;
              const finalPhoto = tempProfilePicBase64 || data.photo || defaultPic;
              
              if(uRealName || tempProfilePicBase64) {
                  await update(userNode, { displayName: finalName, photo: finalPhoto });
              }
              
              // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…Ù…ÙŠØ²
              const premiumSnap = await get(child(premiumRef, data.uid));
              let premiumData = {
                  isPremium: false,
                  premiumId: data.uid,
                  premiumGradient: 1,
                  premiumUntil: 0
              };
              
              if(premiumSnap.exists()) {
                  premiumData = premiumSnap.val();
              }
              
              const userData = {
                  username: uUser,
                  displayName: finalName,
                  photo: finalPhoto,
                  uid: data.uid,
                  bio: data.bio || "Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø´Ø§Øª Ø¨Ù„Ø³",
                  isAdmin: data.isAdmin || false,
                  isPremium: premiumData.isPremium || false,
                  premiumId: premiumData.premiumId || data.uid,
                  premiumGradient: premiumData.premiumGradient || 1,
                  premiumUntil: premiumData.premiumUntil || 0
              };
              
              startChat(userData);
          } else { 
              showAlert("â›” ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©", "error"); 
          }
      } else {
          // Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
          if(!uRealName) { 
              showAlert("ğŸ“ Ù„Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©ØŒ Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø¸Ø§Ù‡Ø±", "warning"); 
              return; 
          }
          
          const newUid = Math.floor(1000000000 + Math.random() * 9000000000).toString();
          const finalPhoto = tempProfilePicBase64 || defaultPic;

          const userData = {
              password: uPass,
              uid: newUid,
              displayName: uRealName,
              photo: finalPhoto,
              bio: "Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø´Ø§Øª Ø¨Ù„Ø³",
              isAdmin: false,
              isPremium: false
          };

          await set(userNode, userData);
          
          const newUser = {
              username: uUser,
              displayName: uRealName,
              photo: finalPhoto,
              uid: newUid,
              bio: "Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø´Ø§Øª Ø¨Ù„Ø³",
              isAdmin: false,
              isPremium: false,
              premiumId: newUid,
              premiumGradient: 1,
              premiumUntil: 0
          };
          
          startChat(newUser);
      }
  };

  function startChat(userData) {
      myUser = userData;
      
      // Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø©
      localStorage.setItem("chat_username", myUser.username);
      localStorage.setItem("chat_password", document.getElementById("password").value);
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
      document.getElementById("login-screen").style.display = "none";
      document.getElementById("chat-screen").style.display = "flex";
      
      // ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ù‡ÙŠØ¯Ø±
      document.getElementById("myHeaderAvatar").src = myUser.photo;
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø¨Ø§Ø¯Ø¬ Ø§Ù„Ù…Ù…ÙŠØ² Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù…ÙŠØ²
      updatePremiumUI();
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø£Ø¯Ù…Ù† Ø¥Ø°Ø§ ÙƒØ§Ù† Ø£Ø¯Ù…Ù†
      if(myUser.isAdmin) {
          document.getElementById("admin-panel-btn").style.display = "block";
      }
      
      // ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…Ù…ÙŠØ²
      checkPremiumValidity();
      
      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
      onChildAdded(chatRef, renderMessage);
      
      // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
      monitorPremiumStatus();
      
      showAlert(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${myUser.displayName}!`, "success");
  }

  function updatePremiumUI() {
      if(myUser.isPremium && myUser.premiumUntil > Date.now()) {
          document.getElementById("headerPremiumBadge").style.display = "flex";
          document.getElementById("premium-indicator").style.display = "inline";
          
          // ØªØ­Ø¯ÙŠØ« Ø¥Ø·Ø§Ø± Ø§Ù„ØµÙˆØ±Ø©
          document.getElementById("myHeaderAvatar").classList.add("premium-frame");
      } else {
          document.getElementById("headerPremiumBadge").style.display = "none";
          document.getElementById("premium-indicator").style.display = "none";
          document.getElementById("myHeaderAvatar").classList.remove("premium-frame");
      }
  }

  async function checkPremiumValidity() {
      if(myUser.isPremium && myUser.premiumUntil < Date.now()) {
          // Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
          myUser.isPremium = false;
          await update(child(premiumRef, myUser.uid), { isPremium: false });
          updatePremiumUI();
          showAlert("Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ø´ØªØ±Ø§ÙƒÙƒ Ø§Ù„Ù…Ù…ÙŠØ²", "warning");
      }
  }

  function monitorPremiumStatus() {
      const premiumNode = child(premiumRef, myUser.uid);
      onValue(premiumNode, (snap) => {
          if(snap.exists()) {
              const data = snap.val();
              myUser.isPremium = data.isPremium;
              myUser.premiumUntil = data.premiumUntil;
              myUser.premiumId = data.premiumId || myUser.uid;
              myUser.premiumGradient = data.premiumGradient || 1;
              updatePremiumUI();
          }
      });
  }

  window.logout = () => {
      localStorage.removeItem("chat_username");
      localStorage.removeItem("chat_password");
      location.reload();
  }

  // --- Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ---
  window.sendTextMsg = async () => {
      const input = document.getElementById("msg-input");
      const message = input.value.trim();
      
      if(message) {
          await sendMessage(message, null);
          input.value = "";
          input.focus();
      }
  };

  document.getElementById("msg-input").addEventListener("keydown", (e) => {
      if(e.key === "Enter") window.sendTextMsg();
  });

  document.getElementById("msgImgInput").addEventListener("change", function() {
      if(this.files[0]) {
          compressImage(this.files[0], 400, 0.7, async (base64) => {
             await sendMessage(null, base64);
          });
      }
      this.value = "";
  });

  async function sendMessage(text, imgBase64) {
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø±
      const banCheck = await get(child(bansRef, myUser.uid));
      if (banCheck.exists()) {
          const banData = banCheck.val();
          if (banData.until > Date.now()) { 
              showAlert(`â›” Ø£Ù†Øª Ù…Ø­Ø¸ÙˆØ± Ø­ØªÙ‰ ${new Date(banData.until).toLocaleString()}`, "error"); 
              return; 
          }
      }

      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø³Ø§Ù„Ø©
      const messageData = {
        senderName: myUser.displayName,
        senderPhoto: myUser.photo,
        uid: myUser.uid,
        isAdmin: myUser.isAdmin,
        isPremium: myUser.isPremium && myUser.premiumUntil > Date.now(),
        text: text,
        image: imgBase64,
        type: "msg",
        time: Date.now()
      };
      
      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù…ÙŠØ²ØŒ Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
      if(myUser.isPremium && myUser.premiumUntil > Date.now()) {
          messageData.premiumId = myUser.premiumId;
          messageData.premiumGradient = myUser.premiumGradient;
      }

      await push(chatRef, messageData);
  }

  function renderMessage(snap) {
      const d = snap.val();
      const chatBox = document.getElementById("chat-box");
      const div = document.createElement("div");
      
      if (d.type === "system") {
          div.style.textAlign = "center"; div.style.margin = "10px 0";
          div.innerHTML = `<span style="background:rgba(200,0,0,0.3); color:#ffcccb; padding:4px 8px; border-radius:5px; font-size:11px;">ğŸ”” ${d.text}</span>`;
      } else {
          const isMe = d.uid === myUser.uid;
          div.className = `msg-row ${isMe ? 'me' : 'other'}`;
          
          const time = new Date(d.time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
          let nameColor = d.isAdmin ? '#ff4444' : (d.isPremium ? '#ffd700' : 'var(--accent-color)');
          let nameText = d.isAdmin ? `ğŸ‘‘ ${d.senderName}` : (d.isPremium ? `ğŸ‘‘ ${d.senderName}` : d.senderName);
          
          // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø£Ø¯Ù…Ù† Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ù…Ù†
          let adminButton = '';
          if(myUser.isAdmin && !isMe) {
              adminButton = `<button class="btn-admin-small" onclick="adminAction('${d.uid}', '${d.senderName}')">
                  <i class="fas fa-cog"></i>
              </button>`;
          }
          
          let content = "";
          if(d.text) content += `<div>${d.text}</div>`;
          if(d.image) content += `<img src="${d.image}" class="msg-img-content" onclick="window.open(this.src)">`;

          // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø±Ø³Ø§Ù„Ø© Ù…Ù…ÙŠØ²Ø©ØŒ Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ø®Ø§ØµØ©
          let msgClass = '';
          let gradientStyle = '';
          
          if(d.isPremium) {
              msgClass = 'premium-msg';
              const gradients = [
                  'linear-gradient(45deg, #00bcd4, #0097a7)',
                  'linear-gradient(45deg, #ff4081, #f50057)',
                  'linear-gradient(45deg, #651fff, #7c4dff)',
                  'linear-gradient(45deg, #00e676, #00c853)'
              ];
              
              const gradientIndex = d.premiumGradient || 1;
              gradientStyle = `background: ${gradients[gradientIndex-1]} !important;`;
          }
          
          div.innerHTML = `
            <img class="msg-avatar ${d.isPremium ? 'premium-frame' : ''}" 
                 src="${d.senderPhoto}" 
                 onclick="showUserProfile('${d.uid}')">
            <div class="msg-content ${msgClass}" style="${gradientStyle}">
                <span class="msg-name" style="color:${nameColor}">
                    ${nameText}
                    ${d.isPremium ? `<span style="font-size:9px; color:#ffd700;">ID: ${d.premiumId || d.uid}</span>` : ''}
                </span>
                ${content}
                <div style="font-size:9px; opacity:0.6; text-align:left; margin-top:4px;">
                    ${time}
                    ${adminButton}
                </div>
            </div>
          `;
      }
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
  }

  // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø© ---
  window.openPremiumModal = () => {
      document.getElementById("overlay").style.display = "block";
      document.getElementById("premium-modal").style.display = "block";
  };

  window.closePremiumModal = () => {
      document.getElementById("premium-modal").style.display = "none";
      document.getElementById("overlay").style.display = "none";
  };

  window.activatePremium = async () => {
      const code = document.getElementById("subscription-code").value.trim();
      
      if(!code) {
          showAlert("âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ", "warning");
          return;
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„ÙƒÙˆØ¯
      if(!subscriptionCodes.includes(code)) {
          showAlert("â›” ÙƒÙˆØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ØºÙŠØ± ØµØ§Ù„Ø­", "error");
          return;
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙƒÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹
      const codeSnap = await get(child(codesRef, code));
      if(codeSnap.exists()) {
          showAlert("â›” Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹", "error");
          return;
      }
      
      // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
      const premiumUntil = Date.now() + (30 * 24 * 60 * 60 * 1000); // 30 ÙŠÙˆÙ…
      
      await set(child(premiumRef, myUser.uid), {
          isPremium: true,
          premiumUntil: premiumUntil,
          premiumId: myUser.uid,
          premiumGradient: 1,
          activatedAt: Date.now(),
          activatedBy: myUser.username
      });
      
      // Ø­ÙØ¸ Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…Ø³ØªØ®Ø¯Ù…
      await set(child(codesRef, code), {
          usedBy: myUser.username,
          usedAt: Date.now(),
          validUntil: premiumUntil
      });
      
      // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      myUser.isPremium = true;
      myUser.premiumUntil = premiumUntil;
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
      updatePremiumUI();
      
      // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
      closePremiumModal();
      
      // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
      showAlert("ğŸ‰ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…Ù…ÙŠØ² Ø¨Ù†Ø¬Ø§Ø­ Ù„Ù…Ø¯Ø© 30 ÙŠÙˆÙ…", "success");
      
      // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ø´Ø§Øª
      await push(chatRef, {
          text: `ğŸŠ ${myUser.displayName} Ø£ØµØ¨Ø­ Ø§Ù„Ø¢Ù† Ø¹Ø¶Ùˆ Ù…Ù…ÙŠØ²!`,
          type: "system",
          time: Date.now()
      });
  };

  // --- Ù†Ø¸Ø§Ù… ØªØºÙŠÙŠØ± ID Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ù…ÙŠØ²ÙŠÙ† ---
  window.openPremiumIdModal = () => {
      if(!myUser.isPremium || myUser.premiumUntil < Date.now()) {
          showAlert("â›” Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù…ØªØ§Ø­Ø© ÙÙ‚Ø· Ù„Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…Ù…ÙŠØ²ÙŠÙ†", "error");
          return;
      }
      
      document.getElementById("current-id-display").textContent = myUser.premiumId;
      document.getElementById("new-premium-id").value = "";
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ù…Ø®ØªØ§Ø± Ø­Ø§Ù„ÙŠØ§Ù‹
      selectGradient(myUser.premiumGradient);
      
      document.getElementById("overlay").style.display = "block";
      document.getElementById("premium-id-modal").style.display = "block";
  };

  window.closePremiumIdModal = () => {
      document.getElementById("premium-id-modal").style.display = "none";
      document.getElementById("overlay").style.display = "none";
  };

  window.selectGradient = (gradientNum) => {
      selectedGradient = gradientNum;
      
      // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
      const colorPreview = document.querySelectorAll('.color-preview');
      colorPreview.forEach((el, index) => {
          if(index === gradientNum - 1) {
              el.classList.add('selected');
          } else {
              el.classList.remove('selected');
          }
      });
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
      const gradients = [
          'linear-gradient(45deg, #00bcd4, #0097a7)',
          'linear-gradient(45deg, #ff4081, #f50057)',
          'linear-gradient(45deg, #651fff, #7c4dff)',
          'linear-gradient(45deg, #00e676, #00c853)'
      ];
      
      document.getElementById("selected-gradient-preview").style.background = gradients[gradientNum - 1];
  };

  window.savePremiumId = async () => {
      const newId = document.getElementById("new-premium-id").value.trim();
      
      if(!newId) {
          showAlert("âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ID Ø¬Ø¯ÙŠØ¯", "warning");
          return;
      }
      
      if(!/^\d+$/.test(newId)) {
          showAlert("â›” ID ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·", "error");
          return;
      }
      
      if(newId.length < 4 || newId.length > 10) {
          showAlert("â›” ID ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 4 Ùˆ 10 Ø£Ø±Ù‚Ø§Ù…", "error");
          return;
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† ID Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹
      const premiumUsersSnap = await get(premiumRef);
      let idExists = false;
      
      if(premiumUsersSnap.exists()) {
          premiumUsersSnap.forEach((childSnap) => {
              const userData = childSnap.val();
              if(userData.premiumId === newId && childSnap.key !== myUser.uid) {
                  idExists = true;
              }
          });
      }
      
      if(idExists) {
          showAlert("â›” Ù‡Ø°Ø§ ID Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹", "error");
          return;
      }
      
      // Ø­ÙØ¸ Ø§Ù„Ù€ ID Ø§Ù„Ø¬Ø¯ÙŠØ¯
      await update(child(premiumRef, myUser.uid), {
          premiumId: newId,
          premiumGradient: selectedGradient
      });
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
      myUser.premiumId = newId;
      myUser.premiumGradient = selectedGradient;
      
      closePremiumIdModal();
      showAlert("âœ… ØªÙ… ØªØºÙŠÙŠØ± ID Ø¨Ù†Ø¬Ø§Ø­", "success");
  };

  // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ---
  window.openMyProfile = async () => {
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
      const snap = await get(child(usersRef, myUser.username));
      if(snap.exists()) {
          const data = snap.val();
          myUser.bio = data.bio || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø¨Ø°Ø©";
          myUser.photo = data.photo;
      }
      
      showUserProfile(myUser.uid, true);
  };

  async function showUserProfile(uid, isMe = false) {
      // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„Ù€ UID
      const usersSnap = await get(usersRef);
      let userData = null;
      
      if(usersSnap.exists()) {
          usersSnap.forEach((childSnap) => {
              const data = childSnap.val();
              if(data.uid === uid) {
                  userData = {
                      username: childSnap.key,
                      displayName: data.displayName,
                      photo: data.photo,
                      uid: data.uid,
                      bio: data.bio || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ©",
                      isAdmin: data.isAdmin || false
                  };
              }
          });
      }
      
      if(!userData) {
          showAlert("â›” Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…", "error");
          return;
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù…ÙŠØ²
      const premiumSnap = await get(child(premiumRef, uid));
      if(premiumSnap.exists()) {
          const premiumData = premiumSnap.val();
          userData.isPremium = premiumData.isPremium && premiumData.premiumUntil > Date.now();
          userData.premiumId = premiumData.premiumId || uid;
      } else {
          userData.isPremium = false;
          userData.premiumId = uid;
      }
      
      selectedUserProfile = userData;
      
      // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
      document.getElementById("pModalImg").src = userData.photo;
      document.getElementById("pModalName").textContent = userData.displayName;
      
      // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù€ ID
      const uidElement = document.getElementById("pModalUid");
      uidElement.textContent = userData.premiumId;
      uidElement.className = userData.isPremium ? "badge-id premium-id" : "badge-id";
      
      document.getElementById("pModalBio").textContent = userData.bio;
      
      // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
      const amITheOwner = (uid === myUser.uid);
      document.getElementById("editProfileTools").style.display = amITheOwner ? "block" : "none";
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± ØªØºÙŠÙŠØ± ID Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ù…ÙŠØ²ÙŠÙ†
      if(amITheOwner && myUser.isPremium && myUser.premiumUntil > Date.now()) {
          document.getElementById("change-id-btn").style.display = "block";
      } else {
          document.getElementById("change-id-btn").style.display = "none";
      }
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø£Ø¯Ù…Ù†
      if(myUser.isAdmin && !amITheOwner) {
          document.getElementById("adminPanel").style.display = "block";
      } else {
          document.getElementById("adminPanel").style.display = "none";
      }
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
      document.getElementById("overlay").style.display = "block";
      document.getElementById("profileModal").style.display = "block";
  }

  window.previewEditPic = (input) => {
      if(input.files[0]) {
          compressImage(input.files[0], 150, 0.7, (base64) => {
              tempEditPicBase64 = base64;
              document.getElementById("pModalImg").src = base64;
          });
      }
  };

  window.saveProfileChanges = async () => {
      const newBio = document.getElementById("editBioInput").value.trim();
      const updates = {};
      
      if(newBio) {
          updates.bio = newBio;
          myUser.bio = newBio;
          document.getElementById("pModalBio").textContent = newBio;
      }
      
      if(tempEditPicBase64) {
          updates.photo = tempEditPicBase64;
          myUser.photo = tempEditPicBase64;
          document.getElementById("myHeaderAvatar").src = tempEditPicBase64;
          
          // ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
          // (Ù‡Ø°Ù‡ Ø¹Ù…Ù„ÙŠØ© Ù‚Ø¯ ØªÙƒÙˆÙ† Ø«Ù‚ÙŠÙ„Ø©ØŒ ÙŠÙ…ÙƒÙ† ØªØ®Ø·ÙŠÙ‡Ø§ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©)
      }
      
      if(Object.keys(updates).length > 0) {
          await update(child(usersRef, myUser.username), updates);
          showAlert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª", "success");
      }
  };

  window.closeModal = () => {
      document.getElementById("profileModal").style.display = "none";
      document.getElementById("overlay").style.display = "none";
      tempEditPicBase64 = "";
  };

  // --- Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø£Ø¯Ù…Ù† ---
  window.openAdminTools = () => {
      // Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†
      showAlert("Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† Ø¬Ø§Ù‡Ø²Ø©", "info");
  };

  async function adminAction(uid, userName) {
      // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø£Ø¯Ù…Ù† ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
      selectedUserProfile = { uid, name: userName };
      showUserProfile(uid);
  }

  window.executeBan = async () => {
      if(!selectedUserProfile) return;
      
      const hours = parseInt(document.getElementById("banDuration").value) || 1;
      const reason = document.getElementById("banReason").value.trim() || "Ø¨Ø¯ÙˆÙ† Ø³Ø¨Ø¨";
      
      const liftTime = Date.now() + (hours * 60 * 60 * 1000);
      
      await set(child(bansRef, selectedUserProfile.uid), { 
          until: liftTime,
          reason: reason,
          bannedBy: myUser.username,
          bannedAt: Date.now()
      });
      
      // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ø´Ø§Øª
      await push(chatRef, { 
          text: `â›” ØªÙ… Ø­Ø¸Ø± ${selectedUserProfile.displayName} Ù„Ù…Ø¯Ø© ${hours} Ø³Ø§Ø¹Ø© - Ø§Ù„Ø³Ø¨Ø¨: ${reason}`,
          type: "system",
          time: Date.now()
      });
      
      showAlert(`âœ… ØªÙ… Ø­Ø¸Ø± ${selectedUserProfile.displayName}`, "success");
      closeModal();
  };

  window.banIP = async () => {
      if(!selectedUserProfile) return;
      
      // ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ Ø­Ù‚ÙŠÙ‚ÙŠØŒ ØªØ­ØªØ§Ø¬ Ù„ØªØ®Ø²ÙŠÙ† ÙˆØ¹Ø±Ø¶ IP Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      showAlert("â›” Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ØªØ­ØªØ§Ø¬ Ù„ØªØ®Ø²ÙŠÙ† Ø¹Ù†Ø§ÙˆÙŠÙ† IP", "warning");
  };

  window.openSearchModal = () => {
      document.getElementById("overlay").style.display = "block";
      document.getElementById("search-user-modal").style.display = "block";
      document.getElementById("search-user-input").focus();
  };

  window.closeSearchModal = () => {
      document.getElementById("search-user-modal").style.display = "none";
      document.getElementById("overlay").style.display = "none";
  };

  window.searchUser = async () => {
      const searchTerm = document.getElementById("search-user-input").value.trim();
      
      if(!searchTerm) {
          showAlert("âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…ØµØ·Ù„Ø­ Ø§Ù„Ø¨Ø­Ø«", "warning");
          return;
      }
      
      const usersSnap = await get(usersRef);
      const results = [];
      
      if(usersSnap.exists()) {
          usersSnap.forEach((childSnap) => {
              const data = childSnap.val();
              if(data.uid.includes(searchTerm) || 
                 data.displayName.includes(searchTerm) || 
                 childSnap.key.includes(searchTerm)) {
                  
                  results.push({
                      username: childSnap.key,
                      displayName: data.displayName,
                      photo: data.photo,
                      uid: data.uid,
                      isAdmin: data.isAdmin || false
                  });
              }
          });
      }
      
      const resultsContainer = document.getElementById("search-results");
      resultsContainer.innerHTML = "";
      
      if(results.length === 0) {
          resultsContainer.innerHTML = '<p style="color:#888; text-align:center;">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬</p>';
          return;
      }
      
      results.forEach(user => {
          const div = document.createElement("div");
          div.className = "user-result";
          div.innerHTML = `
              <img src="${user.photo}">
              <div style="flex:1;">
                  <div style="font-weight:bold;">${user.displayName}</div>
                  <div style="font-size:11px; color:#888;">ID: ${user.uid} | @${user.username}</div>
              </div>
              ${user.isAdmin ? '<span style="color:#ff4444; font-size:10px;">ğŸ‘‘</span>' : ''}
          `;
          
          div.onclick = () => {
              closeSearchModal();
              showUserProfile(user.uid);
          };
          
          resultsContainer.appendChild(div);
      });
  };

  window.manageSubscriptions = async () => {
      // Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø©
      const premiumSnap = await get(premiumRef);
      let message = "Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø© Ø§Ù„Ù†Ø´Ø·Ø©:\n\n";
      
      if(premiumSnap.exists()) {
          premiumSnap.forEach((childSnap) => {
              const data = childSnap.val();
              if(data.isPremium && data.premiumUntil > Date.now()) {
                  const daysLeft = Math.ceil((data.premiumUntil - Date.now()) / (1000 * 60 * 60 * 24));
                  message += `ID: ${data.premiumId || childSnap.key} - Ù…ØªØ¨Ù‚ÙŠ: ${daysLeft} ÙŠÙˆÙ…\n`;
              }
          });
      } else {
          message = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ù…Ù…ÙŠØ²Ø© Ù†Ø´Ø·Ø©";
      }
      
      showAlert(message, "info");
  };

  // --- ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© ---
  function showAlert(message, type = "info") {
      const alertDiv = document.getElementById("alert-message");
      const alertContent = document.getElementById("alert-content");
      
      // ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
      let borderColor = "#2196F3"; // Ø£Ø²Ø±Ù‚ (Ø§ÙØªØ±Ø§Ø¶ÙŠ)
      if(type === "error") borderColor = "#f44336";
      if(type === "success") borderColor = "#4CAF50";
      if(type === "warning") borderColor = "#FF9800";
      
      alertDiv.style.borderLeftColor = borderColor;
      alertContent.innerHTML = message;
      alertDiv.style.display = "block";
      
      // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
      setTimeout(() => {
          alertDiv.style.display = "none";
      }, 5000);
  }

</script>
</body>
</html>
