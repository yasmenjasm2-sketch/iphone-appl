<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø´Ø§Øª Ù…Ø·ÙˆØ± - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø©</title>
<style>
    body { background:#111; color:white; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding:20px; }
    
    /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ø¨Ø­Ø« */
    .header-controls { display: flex; gap: 10px; margin-bottom: 15px; }
    #searchId { flex: 1; padding: 10px; border-radius: 4px; border: 1px solid #444; background: #222; color: #fff; }
    
    /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø§Øª */
    #chat { height:500px; overflow-y:auto; border:1px solid #333; padding:15px; margin-bottom:10px; background: #0a0a0a; border-radius: 8px; }
    
    /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
    .msg { margin: 8px 0; padding: 8px; border-bottom: 1px solid #222; position: relative; }
    .msg-header { font-size: 0.8em; color: #666; display: flex; justify-content: space-between; }
    .user-id { font-family: monospace; color: #888; }
    
    /* Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
    .name { font-weight:bold; cursor: pointer; text-decoration: underline; }
    .name:hover { color: #fff; }
    .name.user { color:#4fc3f7; }
    
    /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ù…Ù…ÙŠØ² */
    .name.admin { color: #ff4444; }
    .msg.admin-msg .text-content {
        font-weight: bold;
        font-size: 1.1em;
        background: linear-gradient(270deg, #8B0000, #00008B, #8B0000);
        background-size: 600% 600%;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: gradientAnim 3s ease infinite;
    }

    @keyframes gradientAnim {
        0%{background-position:0% 50%}
        50%{background-position:100% 50%}
        100%{background-position:0% 50%}
    }

    /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… (Ø§Ù„Ø­Ø¸Ø±) */
    .sys-msg { background: #330000; border: 1px solid red; color: #ff9999; padding: 10px; text-align: center; border-radius: 5px; }

    /* Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª */
    .input-area { display: flex; gap: 10px; }
    input { padding:10px; box-sizing:border-box; border-radius:4px; border:none; background: #222; color: white; }
    #name { width: 20%; }
    #msg { width: 80%; }

    /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø­Ø¸Ø± (Modal) */
    #banModal {
        display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
        background: #222; border: 2px solid #555; padding: 20px; z-index: 1000;
        width: 300px; text-align: center; border-radius: 8px; box-shadow: 0 0 20px rgba(0,0,0,0.8);
    }
    #banModal h3 { margin-top: 0; color: #ff4444; }
    #banModal button { padding: 8px 15px; margin: 5px; cursor: pointer; border: none; border-radius: 4px; }
    .btn-ban { background: #d32f2f; color: white; }
    .btn-cancel { background: #555; color: white; }
    #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 999; }
</style>
</head>
<body>

<div class="header-controls">
    <input id="searchId" placeholder="ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø¨Ø± ID...">
</div>

<h2>ğŸ’¬ Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø¹Ø§Ù… (Ù†Ø¸Ø§Ù… Ø¢Ù…Ù†)</h2>
<div id="chat"></div>

<div class="input-area">
    <input id="name" placeholder="Ø§Ø³Ù…Ùƒ (texn Ù„Ù„Ø£Ø¯Ù…Ù†)">
    <input id="msg" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." disabled>
</div>
<div style="font-size: 12px; color: #777; margin-top: 5px;">* Ø§Ù„Ø£Ø¯Ù…Ù†: texn | Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: 10 Ø£Ø±Ù‚Ø§Ù… ID</div>

<div id="overlay"></div>
<div id="banModal">
    <h3>â›” Ø­Ø¸Ø± Ù…Ø³ØªØ®Ø¯Ù…</h3>
    <p id="banTargetName"></p>
    <input type="number" id="banDuration" placeholder="Ø§Ù„Ù…Ø¯Ø© (Ù…Ø«Ù„Ø§Ù‹ 5)">
    <select id="banUnit" style="padding: 8px; background: #333; color: white; border: none;">
        <option value="hours">Ø³Ø§Ø¹Ø§Øª</option>
        <option value="seconds">Ø«ÙˆØ§Ù†ÙŠ</option>
    </select>
    <br><br>
    <button class="btn-ban" onclick="confirmBan()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¸Ø±</button>
    <button class="btn-cancel" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
</div>

<script type="module">
  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³ ÙƒÙ…Ø§ Ù‡ÙŠ
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, push, set, get, child, onChildAdded } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDdbUK04WTiBvv3z1K9oYhssfpJTI9fZh4",
    authDomain: "chatdoy.firebaseapp.com",
    databaseURL: "https://chatdoy-default-rtdb.firebaseio.com",
    projectId: "chatdoy",
    storageBucket: "chatdoy.firebasestorage.app",
    messagingSenderId: "922018470576",
    appId: "1:922018470576:web:bbe06151c06e345c4cb975",
    measurementId: "G-6V7VB06ZPL"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const chatRef = ref(db, "messages");
  const bansRef = ref(db, "bans");

  // Ø¹Ù†Ø§ØµØ± HTML
  const chat = document.getElementById("chat");
  const msgInput = document.getElementById("msg");
  const nameInput = document.getElementById("name");
  const searchInput = document.getElementById("searchId");
  const modal = document.getElementById("banModal");
  const overlay = document.getElementById("overlay");
  
  // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  let myId = "";
  let isAdmin = false;
  let targetBanUser = null; // Ù„ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø±Ø§Ø¯ Ø­Ø¸Ø±Ù‡

  // 1. ØªÙˆÙ„ÙŠØ¯ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù€ ID Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù…
  nameInput.addEventListener("input", () => {
      const name = nameInput.value.trim();
      
      if(name === "texn") {
          myId = "1111";
          isAdmin = true;
          msgInput.placeholder = "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ø£Ø¯Ù…Ù† texn";
      } else {
          // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø£Ø¯Ù…Ù†ØŒ Ù†ÙˆÙ„Ø¯ Ù„Ù‡ ID Ø¹Ø´ÙˆØ§Ø¦ÙŠ 10 Ø£Ø±Ù‚Ø§Ù… Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù„Ø¯ÙŠÙ‡ ÙˆØ§Ø­Ø¯
          if(!localStorage.getItem("user_random_id")) {
              localStorage.setItem("user_random_id", Math.floor(1000000000 + Math.random() * 9000000000));
          }
          myId = localStorage.getItem("user_random_id");
          isAdmin = false;
          msgInput.placeholder = "Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...";
      }
      
      // ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø§Ø³Ù…
      msgInput.disabled = name.length === 0;
  });

  // 2. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
  msgInput.addEventListener("keydown", async (e) => {
    if(e.key === "Enter" && msgInput.value.trim()){
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
      const banCheck = await get(child(bansRef, myId));
      if (banCheck.exists()) {
          const banData = banCheck.val();
          if (banData.until > Date.now()) {
              alert(`â›” Ø£Ù†Øª Ù…Ø­Ø¸ÙˆØ± Ø­ØªÙ‰: ${new Date(banData.until).toLocaleTimeString()}`);
              return;
          }
      }

      const msgData = {
        name: nameInput.value || "Ø²Ø§Ø¦Ø±",
        text: msgInput.value,
        uid: myId,
        isAdmin: isAdmin,
        type: "msg", // msg or system
        time: Date.now()
      };

      push(chatRef, msgData);
      msgInput.value = "";
    }
  });

  // 3. Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
  onChildAdded(chatRef, snap => {
    const d = snap.val();
    const div = document.createElement("div");
    
    // ÙÙ„ØªØ±Ø© Ø§Ù„Ø¨Ø­Ø«
    div.dataset.uid = d.uid; // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù€ ID ÙÙŠ Ø§Ù„Ø¹Ù†ØµØ± Ù„Ù„Ø¨Ø­Ø«

    if (d.type === "system") {
        // Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… (Ø§Ù„Ø­Ø¸Ø±)
        div.className = "msg sys-msg";
        div.innerHTML = `âš ï¸ ${d.text}`;
    } else {
        // Ø±Ø³Ø§Ù„Ø© Ø¹Ø§Ø¯ÙŠØ©
        div.className = `msg ${d.isAdmin ? "admin-msg" : ""}`;
        
        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª
        const timeObj = new Date(d.time);
        const timeStr = timeObj.getHours() + ":" + timeObj.getMinutes();

        // Ù„ÙˆÙ† Ø§Ù„Ø§Ø³Ù… (Ø£Ø¯Ù…Ù† Ø£Ùˆ Ù…Ø³ØªØ®Ø¯Ù…)
        const nameClass = d.isAdmin ? "name admin" : "name user";
        
        div.innerHTML = `
            <div class="msg-header">
                <span class="user-id">ID: ${d.uid}</span>
                <span>${timeStr}</span>
            </div>
            <div>
                <span class="${nameClass}" onclick="openAdminMenu('${d.name}', '${d.uid}', ${d.isAdmin})">${d.name}</span>: 
                <span class="text-content">${d.text}</span>
            </div>
        `;
    }

    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
    
    // ØªØ´ØºÙŠÙ„ ÙÙ„ØªØ± Ø§Ù„Ø¨Ø­Ø« Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¨Ø­Ø«
    filterMessages();
  });

  // 4. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø¯Ù…Ù† (ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©)
  window.openAdminMenu = (userName, userId, isTargetAdmin) => {
      if (!isAdmin) return; // ÙÙ‚Ø· Ø§Ù„Ø£Ø¯Ù…Ù† ÙŠÙ…ÙƒÙ†Ù‡ ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
      if (userId === "1111") return; // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø¸Ø± Ø§Ù„Ø£Ø¯Ù…Ù† Ù†ÙØ³Ù‡

      targetBanUser = { name: userName, id: userId };
      document.getElementById("banTargetName").innerText = `Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${userName} (ID: ${userId})`;
      modal.style.display = "block";
      overlay.style.display = "block";
  };

  window.closeModal = () => {
      modal.style.display = "none";
      overlay.style.display = "none";
  };

  // 5. ØªÙ†ÙÙŠØ° Ø§Ù„Ø­Ø¸Ø±
  window.confirmBan = () => {
      const duration = document.getElementById("banDuration").value;
      const unit = document.getElementById("banUnit").value;
      
      if (!duration || !targetBanUser) return;

      let multiplier = 1000; // Ø«ÙˆØ§Ù†ÙŠ
      if (unit === "hours") multiplier = 1000 * 60 * 60;
      
      const banTimeMs = duration * multiplier;
      const liftTime = Date.now() + banTimeMs;

      // 1. Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ù„Ù„Ø´Ø§Øª
      push(chatRef, {
          name: "System",
          text: `ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${targetBanUser.name} (ID:${targetBanUser.id}) Ù„Ø£Ù†Ù‡ Ù…Ø³ÙŠØ¡ Ù„Ù…Ø¯Ø© ${duration} ${unit === 'hours' ? 'Ø³Ø§Ø¹Ø©' : 'Ø«Ø§Ù†ÙŠØ©'}.`,
          uid: "0000",
          isAdmin: true,
          type: "system",
          time: Date.now()
      });

      // 2. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¸Ø± ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      set(child(bansRef, targetBanUser.id), {
          until: liftTime,
          reason: "Abusive behavior"
      });

      closeModal();
      alert("ØªÙ… Ø§Ù„Ø­Ø¸Ø± Ø¨Ù†Ø¬Ø§Ø­!");
  };

  // 6. ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¨Ø­Ø«
  searchInput.addEventListener("input", filterMessages);

  function filterMessages() {
      const query = searchInput.value.trim();
      const messages = document.querySelectorAll(".msg");
      
      messages.forEach(msgDiv => {
          if (!query) {
              msgDiv.style.display = "block";
          } else {
              const uid = msgDiv.dataset.uid;
              if (uid && uid.includes(query)) {
                  msgDiv.style.display = "block";
                  msgDiv.style.background = "#222"; // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù†ØªÙŠØ¬Ø©
              } else {
                  msgDiv.style.display = "none";
              }
          }
      });
  }

</script>

</body>
</html>
