<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø´Ø§Øª Ø¨Ù„Ø³ - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø·ÙˆØ±</title>
<style>
    /* --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© ÙˆØªØµÙ…ÙŠÙ… Ø§Ù„Ø®Ù„ÙÙŠØ© --- */
    body { 
        background-color: #050505; 
        background-image: radial-gradient(circle at 50% 50%, #1a1a1a 0%, #000000 100%);
        color: #e0e0e0; 
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        margin: 0; padding: 0; 
        display: flex; justify-content: center; align-items: center; 
        min-height: 100vh; 
        overflow: hidden;
    }
    
    /* --- Ø§Ù„ØªÙ…Ø±ÙŠØ± (Scrollbar) --- */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #111; }
    ::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }

    /* --- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ --- */
    #login-screen {
        background: rgba(20, 20, 20, 0.95); 
        padding: 40px; 
        border-radius: 15px; 
        border: 1px solid #333;
        width: 320px; 
        text-align: center; 
        box-shadow: 0 0 50px rgba(0,0,0,0.9);
        backdrop-filter: blur(5px);
    }
    #login-screen h2 { color: #4fc3f7; margin-bottom: 20px; letter-spacing: 1px; }
    .login-input { 
        width: 100%; padding: 12px; margin: 8px 0; 
        background: #252525; border: 1px solid #444; 
        color: white; border-radius: 6px; box-sizing: border-box; 
        transition: 0.3s;
    }
    .login-input:focus { border-color: #4fc3f7; outline: none; }
    .btn-login { 
        width: 100%; padding: 12px; 
        background: linear-gradient(45deg, #00695c, #004d40); 
        color: white; border: none; border-radius: 6px; 
        cursor: pointer; font-weight: bold; margin-top: 15px; 
        box-shadow: 0 4px 15px rgba(0, 105, 92, 0.4);
        transition: 0.3s; 
    }
    .btn-login:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 105, 92, 0.6); }

    /* --- Ø´Ø§Ø´Ø© Ø§Ù„Ø´Ø§Øª --- */
    #chat-screen { 
        display: none; 
        width: 95%; max-width: 700px; 
        height: 95vh; 
        flex-direction: column; 
        background: rgba(15, 15, 15, 0.9);
        border-radius: 15px;
        border: 1px solid #222;
        box-shadow: 0 0 50px rgba(0,0,0,1);
        overflow: hidden;
    }
    
    /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
    .chat-header {
        padding: 15px;
        background: #1a1a1a;
        border-bottom: 1px solid #333;
        display: flex; gap: 10px; align-items: center;
    }
    #searchId { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #444; background: #0a0a0a; color: #fff; text-align: center; }

    /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
    #chat-box { 
        flex: 1; 
        overflow-y: auto; 
        padding: 20px; 
        background-image: url('https://www.transparenttextures.com/patterns/cubes.png'); /* Ø®Ù„ÙÙŠØ© Ø®ÙÙŠÙØ© */
    }
    
    /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ø³Ø§Ù„Ø© */
    .msg-container {
        display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-start;
        animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .avatar {
        width: 45px; height: 45px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #333;
        cursor: pointer;
        transition: transform 0.2s;
    }
    .avatar:hover { transform: scale(1.1); border-color: #4fc3f7; }

    .msg-bubble {
        background: #222;
        padding: 10px 15px;
        border-radius: 0 15px 15px 15px;
        max-width: 75%;
        border: 1px solid #333;
        position: relative;
    }
    .msg-bubble.admin-bubble {
        background: rgba(40, 0, 0, 0.6);
        border: 1px solid #8B0000;
        border-radius: 15px 0 15px 15px;
    }

    .sender-name {
        font-size: 0.85em;
        font-weight: bold;
        margin-bottom: 4px;
        display: block;
        color: #4fc3f7;
    }
    .sender-name.admin-name { color: #ff1744; text-shadow: 0 0 8px rgba(255, 23, 68, 0.4); }

    .msg-text { font-size: 1em; line-height: 1.4; word-wrap: break-word; }
    
    /* Ù†Øµ Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ù…ØªØ¯Ø±Ø¬ */
    .admin-text {
        font-weight: bold;
        background: linear-gradient(90deg, #ff5252, #448aff, #ff5252);
        background-size: 200% auto;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: shine 3s linear infinite;
    }
    @keyframes shine { to { background-position: 200% center; } }

    .msg-img { max-width: 100%; border-radius: 8px; margin-top: 5px; cursor: pointer; }
    .msg-time { font-size: 0.7em; color: #666; display: block; margin-top: 5px; text-align: left; }
    
    /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… */
    .sys-msg { 
        text-align: center; margin: 10px 0; 
        padding: 5px; background: rgba(255,0,0,0.1); 
        border: 1px solid rgba(255,0,0,0.3); 
        border-radius: 5px; color: #ef9a9a; font-size: 0.85em; 
    }

    /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
    .input-area { 
        padding: 15px; background: #1a1a1a; 
        border-top: 1px solid #333; 
        display: flex; gap: 10px; align-items: center; 
    }
    #msg-input { flex: 1; padding: 12px; border-radius: 25px; border: 1px solid #444; background: #0a0a0a; color: white; }
    .btn-attach {
        background: #333; border: none; color: #ccc; 
        width: 40px; height: 40px; border-radius: 50%; 
        cursor: pointer; font-size: 1.2em; display: flex; align-items: center; justify-content: center;
    }
    .btn-attach:hover { background: #444; color: white; }

    /* --- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ (Modal) --- */
    #profileModal {
        display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
        background: #181818; border: 1px solid #444; padding: 25px; z-index: 1000;
        width: 320px; text-align: center; border-radius: 15px; 
        box-shadow: 0 0 40px rgba(0,0,0,0.8);
    }
    .modal-avatar { width: 100px; height: 100px; border-radius: 50%; border: 3px solid #4fc3f7; object-fit: cover; margin-bottom: 15px; }
    .modal-name { font-size: 1.5em; font-weight: bold; color: white; margin: 5px 0; }
    .modal-id { font-family: monospace; color: #888; background: #222; padding: 5px 10px; border-radius: 5px; display: inline-block; margin-bottom: 15px; }
    
    /* Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø£Ø¯Ù…Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
    .admin-controls { 
        border-top: 1px solid #333; padding-top: 15px; margin-top: 15px; display: none; 
        background: rgba(50, 0, 0, 0.2); border-radius: 8px; padding: 10px;
    }
    .ban-inputs { display: flex; gap: 5px; justify-content: center; margin-bottom: 10px; }
    .btn-ban { background: #d32f2f; color: white; border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; width: 100%; }
    .btn-close { position: absolute; top: 10px; left: 10px; background: none; border: none; color: #666; font-size: 1.5em; cursor: pointer; }

    #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 999; backdrop-filter: blur(3px); }
</style>
</head>
<body>

<div id="login-screen">
    <h2>ğŸ‘¤ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    
    <input type="text" id="username" class="login-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù„Ù„Ø¯Ø®ÙˆÙ„)">
    <input type="password" id="password" class="login-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    
    <div style="border-top: 1px solid #333; margin: 15px 0;"></div>
    
    <input type="text" id="realName" class="login-input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø´Ø®ØµÙŠ (ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø´Ø§Øª)">
    <input type="text" id="photoUrl" class="login-input" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ© (URL)">
    
    <button class="btn-login" onclick="login()">ğŸš€ Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù†</button>
</div>

<div id="chat-screen">
    <div class="chat-header">
        <div style="font-weight:bold; color:#4fc3f7;">Chat<span style="color:white">Plus</span></div>
        <input id="searchId" placeholder="ğŸ” Ø¨Ø­Ø« Ø¹Ù† ID...">
        <button onclick="location.reload()" style="background:#d32f2f; border:none; color:white; width:30px; height:30px; border-radius:50%; cursor:pointer;">âœ•</button>
    </div>

    <div id="chat-box"></div>

    <div class="input-area">
        <input type="file" id="imgInput" hidden accept="image/*">
        <button class="btn-attach" onclick="document.getElementById('imgInput').click()">ğŸ“</button>
        <input id="msg-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...">
    </div>
</div>

<div id="overlay" onclick="closeModal()"></div>
<div id="profileModal">
    <button class="btn-close" onclick="closeModal()">Ã—</button>
    
    <img id="pModalImg" class="modal-avatar" src="">
    <div id="pModalName" class="modal-name"></div>
    <div id="pModalId" class="modal-id"></div>

    <div id="adminPanel" class="admin-controls">
        <h4 style="color: #ff5252; margin: 0 0 10px 0;">ğŸ› ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†</h4>
        <div class="ban-inputs">
            <input type="number" id="banDuration" placeholder="Ø§Ù„Ù…Ø¯Ø©" style="width: 50px; background: #333; border: 1px solid #555; color: white; padding: 5px; border-radius: 4px;">
            <select id="banUnit" style="background: #333; border: 1px solid #555; color: white; border-radius: 4px;">
                <option value="hours">Ø³Ø§Ø¹Ø§Øª</option>
                <option value="seconds">Ø«ÙˆØ§Ù†ÙŠ</option>
            </select>
        </div>
        <button class="btn-ban" onclick="executeBan()">ğŸš« Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</button>
    </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, push, set, get, child, onChildAdded } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDdbUK04WTiBvv3z1K9oYhssfpJTI9fZh4",
    authDomain: "chatdoy.firebaseapp.com",
    databaseURL: "https://chatdoy-default-rtdb.firebaseio.com",
    projectId: "chatdoy",
    storageBucket: "chatdoy.firebasestorage.app",
    messagingSenderId: "922018470576",
    appId: "1:922018470576:web:bbe06151c06e345c4cb975",
    measurementId: "G-6V7VB06ZPL"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const chatRef = ref(db, "messages");
  const bansRef = ref(db, "bans");
  const usersRef = ref(db, "users");

  // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
  let myUser = {
      username: "",
      displayName: "",
      photo: "https://cdn-icons-png.flaticon.com/512/149/149071.png", // ØµÙˆØ±Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
      uid: "",
      isAdmin: false
  };
  let selectedUserProfile = null;

  // Ø±Ø¨Ø· Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø¨Ù€ window
  window.login = handleLogin;
  window.closeModal = () => {
      document.getElementById("profileModal").style.display = "none";
      document.getElementById("overlay").style.display = "none";
  };
  window.showProfile = showProfile;
  window.executeBan = executeBan;

  // --- 1. Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ---
  async function handleLogin() {
      const uUser = document.getElementById("username").value.trim();
      const uPass = document.getElementById("password").value.trim();
      const uRealName = document.getElementById("realName").value.trim();
      const uPhoto = document.getElementById("photoUrl").value.trim();

      if(!uUser || !uPass) { alert("ÙŠØ¬Ø¨ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"); return; }

      // Ø£) Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø®Ø§Øµ
      if (uUser === "texn") {
          if (uPass === "hamzagmail34567") {
              startChat("texn", "ğ‘ğ„ğŒğ€ğ’ à¼—", "https://i.pinimg.com/736x/8b/16/7a/8b167af653c2399dd93b952a48740620.jpg", "1111", true);
          } else { alert("ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø£Ø¯Ù…Ù† Ø®Ø·Ø£"); }
          return;
      }

      // Ø¨) Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
      const userNode = child(usersRef, uUser);
      const snap = await get(userNode);

      if (snap.exists()) {
          // Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯: ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯
          const data = snap.val();
          if (data.password === uPass) {
              // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø°Ø§ Ø£Ø¯Ø®Ù„ Ø¬Ø¯ÙŠØ¯
              const finalName = uRealName || data.displayName;
              const finalPhoto = uPhoto || data.photo || "https://cdn-icons-png.flaticon.com/512/149/149071.png";
              
              // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
              if(uRealName || uPhoto) {
                  set(child(usersRef, uUser + "/displayName"), finalName);
                  set(child(usersRef, uUser + "/photo"), finalPhoto);
              }
              
              startChat(uUser, finalName, finalPhoto, data.uid, false);
          } else {
              alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!");
          }
      } else {
          // Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯: Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
          if(!uRealName) { alert("Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©ØŒ ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø´Ø®ØµÙŠ"); return; }
          
          const newUid = Math.floor(1000000000 + Math.random() * 9000000000).toString();
          const newPhoto = uPhoto || "https://cdn-icons-png.flaticon.com/512/149/149071.png";

          await set(userNode, {
              password: uPass,
              uid: newUid,
              displayName: uRealName,
              photo: newPhoto
          });
          
          alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
          startChat(uUser, uRealName, newPhoto, newUid, false);
      }
  }

  function startChat(username, realName, photo, uid, isAdmin) {
      myUser = { username, displayName: realName, photo, uid, isAdmin };
      
      document.getElementById("login-screen").style.display = "none";
      document.getElementById("chat-screen").style.display = "flex";
      
      // Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„
      onChildAdded(chatRef, renderMessage);
  }

  // --- 2. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (Ù†Øµ + ØµÙˆØ±Ø©) ---
  const msgInput = document.getElementById("msg-input");
  const fileInput = document.getElementById("imgInput");

  // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Øµ
  msgInput.addEventListener("keydown", async (e) => {
    if(e.key === "Enter" && msgInput.value.trim()){
       await sendMessage(msgInput.value.trim(), null);
       msgInput.value = "";
    }
  });

  // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©
  fileInput.addEventListener("change", () => {
      const file = fileInput.files[0];
      if(file) {
          const reader = new FileReader();
          reader.onload = async (e) => {
              // Ø¶ØºØ· Ø§Ù„ØµÙˆØ±Ø© (Ø¨Ø³ÙŠØ·) Ù„ØªÙØ§Ø¯ÙŠ Ø­Ø¬Ù… Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ² Ø§Ù„ÙƒØ¨ÙŠØ±
              const img = new Image();
              img.src = e.target.result;
              img.onload = async () => {
                  const canvas = document.createElement("canvas");
                  const ctx = canvas.getContext("2d");
                  const maxWidth = 300; // ØªØµØºÙŠØ± Ø§Ù„ØµÙˆØ±Ø©
                  const scale = maxWidth / img.width;
                  canvas.width = maxWidth;
                  canvas.height = img.height * scale;
                  ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                  
                  const compressedBase64 = canvas.toDataURL("image/jpeg", 0.7);
                  await sendMessage(null, compressedBase64);
              }
          };
          reader.readAsDataURL(file);
      }
      fileInput.value = ""; // ØªÙØ±ÙŠØº
  });

  async function sendMessage(text, imgBase64) {
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¸Ø±
      const banCheck = await get(child(bansRef, myUser.uid));
      if (banCheck.exists()) {
          const banData = banCheck.val();
          if (banData.until > Date.now()) {
              alert("â›” Ø£Ù†Øª Ù…Ø­Ø¸ÙˆØ± Ù…Ù† Ø§Ù„ÙƒØªØ§Ø¨Ø©!");
              return;
          }
      }

      push(chatRef, {
        senderName: myUser.displayName,
        senderPhoto: myUser.photo,
        uid: myUser.uid,
        isAdmin: myUser.isAdmin,
        text: text,
        image: imgBase64,
        type: "msg",
        time: Date.now()
      });
  }

  // --- 3. Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ---
  function renderMessage(snap) {
    const d = snap.val();
    const chatBox = document.getElementById("chat-box");
    
    // ÙÙ„ØªØ±Ø© Ø§Ù„Ø¨Ø­Ø«
    const div = document.createElement("div");
    div.dataset.uid = d.uid; 

    if (d.type === "system") {
        div.className = "sys-msg";
        div.innerHTML = `âš ï¸ ${d.text}`;
    } else {
        div.className = "msg-container";
        
        // Ø¥Ø°Ø§ ÙƒÙ†Øª Ø£Ù†Ø§ Ø§Ù„Ù…Ø±Ø³Ù„ Ø§Ø¹ÙƒØ³ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ù‡Ù†Ø§ Ù…ÙˆØ­Ø¯ Ù„Ù„ÙŠØ³Ø§Ø± Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©)
        
        const timeStr = new Date(d.time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        const nameClass = d.isAdmin ? "sender-name admin-name" : "sender-name";
        const bubbleClass = d.isAdmin ? "msg-bubble admin-bubble" : "msg-bubble";
        const textClass = d.isAdmin ? "msg-text admin-text" : "msg-text";

        let contentHtml = "";
        if(d.text) contentHtml += `<div class="${textClass}">${d.text}</div>`;
        if(d.image) contentHtml += `<img src="${d.image}" class="msg-img" onclick="window.open(this.src)">`;

        div.innerHTML = `
            <img class="avatar" src="${d.senderPhoto}" onclick="showProfile('${d.senderName}', '${d.senderPhoto}', '${d.uid}')">
            <div class="${bubbleClass}">
                <span class="${nameClass}">${d.senderName}</span>
                ${contentHtml}
                <span class="msg-time">${timeStr}</span>
            </div>
        `;
    }

    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
    filterMessages();
  }

  // --- 4. Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ÙˆØ§Ù„Ø£Ø¯Ù…Ù† ---
  function showProfile(name, photo, uid) {
      selectedUserProfile = { name, uid };
      
      // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
      document.getElementById("pModalImg").src = photo;
      document.getElementById("pModalName").innerText = name;
      document.getElementById("pModalId").innerText = "ID: " + uid;
      
      const adminPanel = document.getElementById("adminPanel");
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒÙ†Øª Ø£Ù†Ø§ Ø£Ø¯Ù…Ù†ØŒ ÙˆØ§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ù„ÙŠØ³ Ù„ÙŠ ÙˆÙ„ÙŠØ³ Ù„Ø£Ø¯Ù…Ù† Ø¢Ø®Ø±
      if (myUser.isAdmin && uid !== "1111" && uid !== myUser.uid) {
          adminPanel.style.display = "block";
      } else {
          adminPanel.style.display = "none";
      }

      document.getElementById("profileModal").style.display = "block";
      document.getElementById("overlay").style.display = "block";
  }

  function executeBan() {
      if(!selectedUserProfile) return;
      
      const duration = document.getElementById("banDuration").value;
      const unit = document.getElementById("banUnit").value;
      
      if(!duration) { alert("Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø¯Ø©"); return; }

      let multiplier = 1000;
      if (unit === "hours") multiplier = 1000 * 60 * 60;
      
      const liftTime = Date.now() + (duration * multiplier);

      // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù†Ø¸Ø§Ù…
      push(chatRef, {
          text: `ØªÙ… Ø­Ø¸Ø± ${selectedUserProfile.name} Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø£Ø¯Ù…Ù† Ù„Ù…Ø¯Ø© ${duration} ${unit === 'hours' ? 'Ø³Ø§Ø¹Ø©' : 'Ø«Ø§Ù†ÙŠØ©'}.`,
          type: "system",
          uid: "0000",
          time: Date.now()
      });

      // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¸Ø±
      set(child(bansRef, selectedUserProfile.uid), {
          until: liftTime,
          reason: "Admin Ban"
      });

      window.closeModal();
      alert("ØªÙ… Ø§Ù„Ø­Ø¸Ø±!");
  }

  // --- 5. Ø§Ù„Ø¨Ø­Ø« ---
  document.getElementById("searchId").addEventListener("input", filterMessages);
  function filterMessages() {
      const query = document.getElementById("searchId").value.trim();
      const msgs = document.querySelectorAll("#chat-box > div"); // Direct children only
      msgs.forEach(m => {
          if(!query) {
              m.style.display = "flex"; // Restore flex layout
          } else {
              if(m.dataset.uid && m.dataset.uid.includes(query)) m.style.display = "flex";
              else m.style.display = "none";
          }
      });
  }
</script>

</body>
</html>
