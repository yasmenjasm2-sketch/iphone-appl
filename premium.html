<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ø´Ø§Øª Ø¨Ù„Ø³ - Ø´Ø±Ø§Ø¡ Ù…Ù…ÙŠØ²</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;800&display=swap" rel="stylesheet">
<style>
    :root {
        --bg-dark: #0a0a0a;
        --bg-panel: #141414;
        --accent-gold: #ffd700;
        --accent-glow: rgba(255, 215, 0, 0.4);
        --text-main: #ececec;
        --text-secondary: #aaaaaa;
        --gradient-premium: linear-gradient(135deg, #ffd700, #ffed4e, #ffd700);
    }

    * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

    body { 
        background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1a2e 50%, #16213e 100%);
        background-attachment: fixed;
        color: var(--text-main);
        font-family: 'Tajawal', sans-serif;
        margin: 0; padding: 20px;
        min-height: 100vh;
        display: flex; flex-direction: column; align-items: center;
    }

    @keyframes glowPulse {
        0%, 100% { box-shadow: 0 0 20px var(--accent-glow); }
        50% { box-shadow: 0 0 40px var(--accent-glow), 0 0 60px var(--accent-glow); }
    }

    .premium-card {
        background: rgba(20, 20, 20, 0.95);
        backdrop-filter: blur(20px);
        padding: 30px;
        border-radius: 25px;
        border: 2px solid rgba(255, 215, 0, 0.3);
        width: 95%; max-width: 400px;
        text-align: center;
        box-shadow: 0 25px 60px rgba(0,0,0,0.7);
        animation: glowPulse 2s ease-in-out infinite;
        margin-bottom: 20px;
    }

    .crown-icon { font-size: 50px; margin-bottom: 15px; background: var(--gradient-premium); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

    .premium-title { 
        color: var(--accent-gold); font-weight: 800; font-size: 24px; margin: 0 0 10px 0;
        text-shadow: 0 0 20px var(--accent-glow);
    }

    .premium-subtitle { color: var(--text-secondary); margin-bottom: 25px; font-size: 14px; }

    .subscription-input { 
        width: 100%; padding: 15px; background: rgba(0,0,0,0.5); border: 2px solid transparent;
        color: white; border-radius: 15px; font-size: 16px; font-weight: 500; text-align: center;
        transition: all 0.3s; margin-bottom: 15px; letter-spacing: 2px; text-transform: uppercase;
    }
    .subscription-input:focus { 
        border-color: var(--accent-gold); box-shadow: 0 0 20px var(--accent-glow);
        transform: scale(1.02);
    }

    .btn-premium { 
        width: 100%; padding: 16px;
        background: var(--gradient-premium); color: #000; border: none; border-radius: 15px;
        font-weight: 800; cursor: pointer; font-size: 18px; letter-spacing: 1px;
        box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4); transition: all 0.3s;
        position: relative; overflow: hidden;
    }
    .btn-premium:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(255, 215, 0, 0.6); }
    .btn-premium:active { transform: translateY(-1px); }

    .valid-codes { 
        background: rgba(0, 255, 0, 0.1); border: 1px solid rgba(0, 255, 0, 0.3);
        border-radius: 10px; padding: 15px; margin-top: 15px; color: #90ee90;
        font-family: monospace; font-size: 12px; text-align: left; max-height: 200px; overflow-y: auto;
    }

    .contact-admin {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white; text-decoration: none; padding: 12px 20px; border-radius: 25px;
        font-weight: bold; display: inline-block; margin-top: 15px; transition: 0.3s;
    }
    .contact-admin:hover { transform: scale(1.05); box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4); }

    .back-btn {
        position: fixed; top: 20px; left: 20px; background: rgba(0,0,0,0.7); color: white;
        border: none; padding: 12px 18px; border-radius: 50%; font-size: 18px; cursor: pointer;
        backdrop-filter: blur(10px); z-index: 100;
    }

    .custom-id-panel {
        background: rgba(255, 215, 0, 0.1); border: 1px solid var(--accent-gold);
        border-radius: 15px; padding: 20px; margin-top: 20px; display: none;
    }
    .custom-id-input { 
        width: 100%; padding: 12px; background: rgba(0,0,0,0.6); border: 1px solid var(--accent-gold);
        color: var(--accent-gold); border-radius: 10px; font-weight: bold; text-align: center;
        margin-bottom: 10px; font-family: monospace;
    }
    .color-inputs { display: flex; gap: 10px; margin-bottom: 15px; }
    .color-input { flex: 1; height: 50px; border: none; border-radius: 10px; cursor: pointer; }

    @keyframes successShake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }
    .success-animation { animation: successShake 0.6s ease-in-out; background: linear-gradient(135deg, #00ff88, #00cc6a) !important; }

    .search-panel {
        background: rgba(20, 20, 20, 0.9); border-radius: 15px; padding: 20px; margin-top: 15px;
        border: 1px solid #333;
    }
    .search-input { width: 100%; padding: 12px; background: #222; border: 1px solid #444; color: white; border-radius: 8px; }
</style>
</head>
<body>
    <button class="back-btn" onclick="window.location.href='index.html'">â†</button>

    <div class="premium-card">
        <div class="crown-icon">ğŸ‘‘</div>
        <h1 class="premium-title">Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ù…ÙŠØ²</h1>
        <p class="premium-subtitle">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…ÙŠØ²Ø§Øª Ø­ØµØ±ÙŠØ© ÙˆØªÙ…ÙŠØ² ÙÙŠ Ø§Ù„Ø´Ø§Øª!</p>
        
        <div class="search-panel">
            <input type="text" id="searchUserId" class="search-input" placeholder="ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„Ù€ ID">
            <button class="btn-premium" style="font-size:14px; padding:10px; margin-top:10px;" onclick="searchUser()">Ø¨Ø­Ø«</button>
            <div id="searchResult" style="margin-top:10px; font-size:12px; color:#aaa;"></div>
        </div>

        <input type="text" id="subscriptionCode" class="subscription-input" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù‡Ù†Ø§..." maxlength="30">
        <button class="btn-premium" onclick="activateSubscription()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ğŸ‘‘</button>
        
        <div id="codeStatus" style="font-size:12px; margin-top:10px;"></div>
        
        <a href="https://wa.me/966500000000" class="contact-admin" target="_blank">
            ğŸ“± ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø¯Ù…Ù† Ù„Ø´Ø±Ø§Ø¡ ÙƒÙˆØ¯
        </a>

        <div id="customIdPanel" class="custom-id-panel">
            <h3 style="color:var(--accent-gold); margin:0 0 15px 0;">ğŸ¨ ØªØ®ØµÙŠØµ Ø§Ù„Ù€ ID ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù†</h3>
            <input type="text" id="customIdInput" class="custom-id-input" placeholder="Ø£Ø¯Ø®Ù„ ID Ù…Ù…ÙŠØ² (5-12 Ø±Ù‚Ù…)" maxlength="12">
            <div class="color-inputs">
                <input type="color" id="color1" class="color-input" value="#ff6b6b">
                <input type="color" id="color2" class="color-input" value="#4ecdc4">
            </div>
            <button class="btn-premium" onclick="saveCustomSettings()" style="font-size:14px;">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getDatabase, ref, get, set, update } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDdbUK04WTiBvv3z1K9oYhssfpJTI9fZh4",
            authDomain: "chatdoy.firebaseapp.com",
            databaseURL: "https://chatdoy-default-rtdb.firebaseio.com",
            projectId: "chatdoy",
            storageBucket: "chatdoy.firebasestorage.app",
            messagingSenderId: "922018470576",
            appId: "1:922018470576:web:bbe06151c06e345c4cb975"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const usersRef = ref(db, "users");

        // Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø³Ø±ÙŠØ© (Ù…Ø­Ù…ÙŠØ©)
        const VALID_CODES = new Set([
            "FAI-TRIAL-AB3C-C5D7-E9F1", "FAI-TRIAL-F5F9-GA7B-IE11", 
            "FAI-TRIAL-M3N5-O7P9-Q1R3", "FAI-TRIAL-S4T6-V8W7-W2X7",
            "FAI-TRIAL-Y5Z7-A9B1C3D5", "FAI-TRIAL-E6F8-G0H2-I4J6",
            "FAI-TRIAL-K7L9-M1N3-O5P7", "FAI-TRIAL-Q8R0-S2T4-U6V8",
            "FAI-TRIAL-W9X1-Y3Z5-A7B9", "FAI-TRIAL-C0D2-E4F6G-G8H3"
        ]);

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        window.onload = async () => {
            const username = localStorage.getItem("chat_username");
            if (!username) {
                alert("âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
                window.location.href = "index.html";
                return;
            }
            
            // ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            const userSnap = await get(ref(db, `users/${username}`));
            if (userSnap.exists()) {
                const userData = userSnap.val();
                if (userData.premium) {
                    document.getElementById("subscriptionCode").placeholder = "âœ… Ø§Ø´ØªØ±Ø§ÙƒÙƒ Ù…ÙØ¹Ù„ Ø¨Ø§Ù„ÙØ¹Ù„";
                    document.querySelector(".premium-card").classList.add("success-animation");
                }
                if (userData.customId) {
                    document.getElementById("customIdPanel").style.display = "block";
                    document.getElementById("customIdInput").value = userData.customId;
                    document.getElementById("color1").value = userData.color1 || "#ff6b6b";
                    document.getElementById("color2").value = userData.color2 || "#4ecdc4";
                }
            }
        };

        window.activateSubscription = async () => {
            const code = document.getElementById("subscriptionCode").value.trim().toUpperCase();
            const statusEl = document.getElementById("codeStatus");
            const username = localStorage.getItem("chat_username");

            if (!code) {
                statusEl.innerHTML = '<span style="color:#ff6b6b;">âš ï¸ Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</span>';
                return;
            }

            if (!VALID_CODES.has(code)) {
                statusEl.innerHTML = '<span style="color:#ff4444;">âŒ ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­</span>';
                return;
            }

            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… (Ø­Ù…Ø§ÙŠØ©)
            VALID_CODES.delete(code);

            // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            const userRef = ref(db, `users/${username}`);
            await update(userRef, {
                premium: true,
                premiumActivated: Date.now(),
                premiumCode: code
            });

            statusEl.innerHTML = '<span style="color:#00ff88;">âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‘‘</span>';
            document.getElementById("subscriptionCode").classList.add("success-animation");
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ®ØµÙŠØµ
            setTimeout(() => {
                document.getElementById("customIdPanel").style.display = "block";
            }, 1500);
        };

        window.saveCustomSettings = async () => {
            const customId = document.getElementById("customIdInput").value.trim();
            const color1 = document.getElementById("color1").value;
            const color2 = document.getElementById("color2").value;
            const username = localStorage.getItem("chat_username");

            if (customId.length < 5 || customId.length > 12) {
                alert("âš ï¸ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ù€ ID Ø¨ÙŠÙ† 5-12 Ø±Ù‚Ù…/Ø­Ø±Ù");
                return;
            }

            await update(ref(db, `users/${username}`), {
                customId: customId,
                color1: color1,
                color2: color2
            });

            alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
        };

        window.searchUser = async () => {
            const searchId = document.getElementById("searchUserId").value.trim();
            const resultEl = document.getElementById("searchResult");
            
            if (!searchId) return;

            // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Ù…Ø­Ø¯ÙˆØ¯ Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©)
            resultEl.innerHTML = "ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...";
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø¨Ø­Ø« (ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ø³ØªÙƒÙˆÙ† Ø§Ø³ØªØ¹Ù„Ø§Ù… Firebase Ø­Ù‚ÙŠÙ‚ÙŠ)
            setTimeout(() => {
                resultEl.innerHTML = `
                    <div style="background:rgba(0,255,0,0.1); padding:10px; border-radius:8px; margin-top:5px;">
                        <strong>ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰:</strong><br>
                        Ø§Ø³Ù…: Ù…Ø«Ø§Ù„ÙŠ ${searchId}<br>
                        Ø­Ø§Ù„Ø©: Ù†Ø´Ø· âœ…<br>
                        Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ±: Ø§Ù„Ø¢Ù†
                    </div>
                `;
            }, 1000);
        };
    </script>
</body>
</html>
