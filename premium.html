<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…Ø§Ø³ÙŠ</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;800&display=swap" rel="stylesheet">
<style>
    body {
        background-color: #000;
        background-image: 
            radial-gradient(circle at 10% 10%, #1a051a 0%, transparent 40%),
            radial-gradient(circle at 90% 90%, #051a1a 0%, transparent 40%);
        color: white; font-family: 'Tajawal', sans-serif;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box;
    }

    .card {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 215, 0, 0.2);
        padding: 40px 25px; border-radius: 25px;
        width: 100%; max-width: 420px;
        text-align: center;
        box-shadow: 0 0 60px rgba(0, 188, 212, 0.1);
        position: relative; overflow: hidden;
    }

    /* Glow Effect */
    .card::before {
        content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
        background: conic-gradient(transparent, rgba(0, 229, 255, 0.1), transparent 30%);
        animation: rotate 4s linear infinite; pointer-events: none;
    }
    @keyframes rotate { 100% { transform: rotate(1turn); } }

    h1 {
        background: linear-gradient(to right, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
        -webkit-background-clip: text; color: transparent;
        margin: 0 0 10px 0; font-size: 32px; letter-spacing: 1px;
    }

    .input-group { margin: 25px 0; text-align: right; position: relative; z-index: 2; }
    label { font-size: 13px; color: #00e5ff; font-weight: bold; margin-bottom: 8px; display: block; }
    
    input {
        width: 100%; padding: 15px; background: rgba(0,0,0,0.6);
        border: 1px solid #333; border-radius: 12px; color: #fff;
        font-family: monospace; letter-spacing: 1px; box-sizing: border-box;
        transition: 0.3s; font-size: 14px;
    }
    input:focus { border-color: #ffd700; box-shadow: 0 0 20px rgba(255, 215, 0, 0.15); outline: none; }

    /* Canvas Preview Area */
    .id-preview-box {
        background: #000; border: 1px dashed #444; border-radius: 15px;
        margin: 15px 0; padding: 10px; display: flex; justify-content: center;
    }
    canvas { max-width: 100%; height: auto; }

    .btn {
        width: 100%; padding: 16px; border: none; border-radius: 12px;
        font-weight: bold; cursor: pointer; margin-top: 15px; font-size: 16px;
        position: relative; z-index: 2; transition: 0.2s;
    }
    .btn-buy {
        background: linear-gradient(45deg, #1e1e1e, #333);
        color: #fff; border: 1px solid #444;
    }
    .btn-activate {
        background: linear-gradient(90deg, #ff00cc, #333399, #00e5ff);
        color: white; box-shadow: 0 5px 20px rgba(0, 229, 255, 0.3);
    }
    .btn-activate:active { transform: scale(0.98); }

</style>
</head>
<body>

<div class="card">
    <h1>DIAMOND PASS</h1>
    <p style="color:#888; font-size:12px;">Ù…ÙŠØ² Ù†ÙØ³Ùƒ Ø¨Ø£Ù„ÙˆØ§Ù† Ù…ØªØ­Ø±ÙƒØ© ÙˆÙ…Ø¹Ø±Ù Ø®Ø§Øµ (Custom ID)</p>

    <!-- Admin Contact -->
    <button onclick="window.open('https://t.me/YOUR_ADMIN_LINK', '_blank')" class="btn btn-buy">
        ğŸ’¬ ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù„Ø´Ø±Ø§Ø¡ ÙƒÙˆØ¯
    </button>
    
    <hr style="border-color:rgba(255,255,255,0.1); margin:25px 0;">

    <!-- Activation Form -->
    <div class="input-group">
        <label>1. ØµÙ…Ù… Ø§Ù„Ù…Ø¹Ø±Ù Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ (ID)</label>
        <div class="id-preview-box">
            <canvas id="idCanvas" width="300" height="80"></canvas>
        </div>
        <input type="text" id="customID" placeholder="Ù…Ø«Ø§Ù„: KING-001" maxlength="14" oninput="drawID()">
    </div>

    <div class="input-group">
        <label>2. Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label>
        <input type="text" id="subCode" placeholder="FAI-TRIAL-XXXX-XXXX">
    </div>

    <button onclick="activatePremium()" class="btn btn-activate">âœ¨ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø¢Ù†</button>
    <div style="margin-top:15px; font-size:12px; cursor:pointer; color:#777;" onclick="location.href='index.html'">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø´Ø§Øª</div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, update, get, child, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = { apiKey: "AIzaSyDdbUK04WTiBvv3z1K9oYhssfpJTI9fZh4", authDomain: "chatdoy.firebaseapp.com", databaseURL: "https://chatdoy-default-rtdb.firebaseio.com", projectId: "chatdoy", storageBucket: "chatdoy.firebasestorage.app", messagingSenderId: "922018470576", appId: "1:922018470576:web:bbe06151c06e345c4cb975" };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // --- Protected Code List (Client Side Validation) ---
    // Note: In a 100% secure app, this should be in Cloud Functions.
    // However, we combine this with Firebase "usedCodes" check for security.
    const secureCodes = [
        "FAI-TRIAL-AB3C-C5D7-E9F1", "FAI-TRIAL-F5F9-GA7B-IE11", 
        "FAI-TRIAL-M3N5-O7P9-Q1R3", "FAI-TRIAL-S4T6-V8W7-W2X7",
        "FAI-TRIAL-Y5Z7-A9B1C3D5", "FAI-TRIAL-E6F8-G0H2-I4J6",
        "FAI-TRIAL-K7L9-M1N3-O5P7", "FAI-TRIAL-Q8R0-S2T4-U6V8",
        "FAI-TRIAL-W9X1-Y3Z5-A7B9", "FAI-TRIAL-C0D2-E4F6G-G8H3",
        "FAI-TRIAL-I1J3-K5L7-M9N1", "FAI-TRIAL-O2P4-Q6R8S0T2",
        "FAI-TRIAL-U3V5-V7X9-Y1Z3", "FAI-TRIAL-A4B6-C8D0-E2F4",
        "FAI-TRIAL-G5H7-I9J1-K3L5", "FAI-TRIAL-M6N8-O0P2-Q4R2",
        "FAI-TRIAL-S7T9-U0V3-W5X7", "FAI-TRIAL-Y8Z0-A2B4-C6D8",
        "FAI-TRIAL-E9F1-G3H7-I7J9", "FAI-TRIAL-K4L2-M4N6-O8E8",
        "FAI-TRIAL-Q1R3-S5T7-U9F1", "FAI-TRIAL-W2Z6-Z68-T0B2",
        "FAI-TRIAL-C3D51-7Fgg9G1R3", "FAI-TRIAL-I4J6-K8L0W-M2N6",
        "FAI-TRIAL-O5P7-Q9R1S3D5", "FAI-TRIAL-U5Z8-W0X2-Y4Z6",
        "FAI-TRIAL-A7B9-C1D3-E9F7", "FAI-TRIAL-G8H0-I2J4-K6E8",
        "FAI-TRIAL-M9N1-O3O5S7R0", "FAI-TRIAL-S0V2-U4V6-W8X0",
        "FAI-TRIAL-Y1Z3-A57-9D1", "FAI-TRIAL-E2F4-G6H8-I0J2",
        "FAI-TRIAL-K3L5-M7N1-O1P3", "FAI-TRIAL-Q1R6-S8T0W-U2V2",
        "FAI-TRIAL-W5Z7-Y9Z1-A3B5", "FAI-TRIAL-C6D8-F02-G4J6",
        "FAI-TRIAL-I7J9-K1L3-M5N7", "FAI-TRIAL-O8P0-Q2R4-S6T8",
        "FAI-TRIAL-U5S91-W3X5-Y7Z9", "FAI-TRIAL-W0B2-C4D6E-E80",
        "FAI-TRIAL-G5J3-I5J7-K9C1", "FAI-TRIAL-M2F4-O6N4-Q0V2",
        "FAI-TRIAL-S3T5-U5U9-W1X3", "FAI-TRIAL-Y4Z6-A8B0C2D4",
        "FAI-TRIAL-E5F7-G9H1I-J5", "FAI-TRIAL-K6D8-M0N2-O4E6",
        "FAI-TRIAL-Q7R9-S1T3-U5V7", "FAI-TRIAL-W8Z0-Y2B4-A6D8",
        "FAI-TRIAL-C9D1-E3F5-G9F9"
    ];

    // --- Programmatic Canvas Drawing ---
    window.drawID = () => {
        const txt = document.getElementById("customID").value || "YOUR ID";
        const cvs = document.getElementById("idCanvas");
        const ctx = cvs.getContext("2d");
        
        // 1. Clear
        ctx.clearRect(0, 0, cvs.width, cvs.height);
        
        // 2. Background (Transparent/Dark)
        ctx.fillStyle = "#0a0a0a";
        ctx.fillRect(0, 0, cvs.width, cvs.height);

        // 3. Gradient Text
        const gradient = ctx.createLinearGradient(0, 0, cvs.width, 0);
        gradient.addColorStop(0, "#ff00cc");
        gradient.addColorStop(0.5, "#333399");
        gradient.addColorStop(1, "#00e5ff");

        // 4. Text Settings
        ctx.font = "900 30px Tajawal, sans-serif";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        
        // 5. Glow Effect
        ctx.shadowColor = "rgba(0, 229, 255, 0.8)";
        ctx.shadowBlur = 15;
        
        // 6. Draw
        ctx.fillStyle = gradient;
        ctx.fillText(txt.toUpperCase(), cvs.width / 2, cvs.height / 2);
        
        // 7. Decorative Line
        ctx.shadowBlur = 0;
        ctx.strokeStyle = "rgba(255,255,255,0.2)";
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(20, cvs.height - 10);
        ctx.lineTo(cvs.width - 20, cvs.height - 10);
        ctx.stroke();
    };

    // Initialize Canvas
    window.drawID();

    // --- Activation Logic ---
    window.activatePremium = async () => {
        const code = document.getElementById("subCode").value.trim();
        const customID = document.getElementById("customID").value.trim();
        const username = localStorage.getItem("chatUser"); // Get logged in user

        // Validation
        if(!username) return alert("âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙŠ Ø§Ù„Ø´Ø§Øª Ø£ÙˆÙ„Ø§Ù‹");
        if(!code || !customID) return alert("âš ï¸ Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
        if(customID.length < 3) return alert("â›” Ø§Ù„Ù…Ø¹Ø±Ù Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹");
        
        // 1. Validate Code existence locally
        if(!secureCodes.includes(code)) {
            return alert("âŒ Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­");
        }

        // 2. Validate Code Usage on Server (Protection)
        const codeRef = child(ref(db, "usedCodes"), code);
        const codeSnap = await get(codeRef);

        if(codeSnap.exists()) {
            return alert("âŒ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹!");
        }

        try {
            // 3. Activate User
            await update(ref(db, "users/" + username), {
                isPremium: true,
                customID: customID,
                premiumDate: Date.now()
            });

            // 4. Burn the code
            await set(codeRef, {
                usedBy: username,
                usedAt: Date.now()
            });

            alert("ğŸ‰ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…Ø§Ø³ÙŠ Ø¨Ù†Ø¬Ø§Ø­!");
            window.location.href = "index.html";

        } catch(e) {
            console.error(e);
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„");
        }
    };
</script>

</body>
</html>

